<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mstdlib-1.21.0: SQL Query Extension/Portability Helpers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Mstdlib-1.21.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('group__m__sql__query.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">SQL Query Extension/Portability Helpers<div class="ingroups"><a class="el" href="group__m__sql.html">SQL Subsystem</a></div></div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:ga6ebebe6fd69e22bb87d506b2c7e4e8f0"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__query.html#ga6ebebe6fd69e22bb87d506b2c7e4e8f0">M_sql_query_updlock_type_t</a> { <br />
&#160;&#160;<a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970">M_SQL_QUERY_UPDLOCK_TABLE</a> = 1
, <br />
&#160;&#160;<a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a> = 2
<br />
 }</td></tr>
<tr class="separator:ga6ebebe6fd69e22bb87d506b2c7e4e8f0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga37d5f0e16066904bba1519f2117f4944"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__query.html#ga37d5f0e16066904bba1519f2117f4944">M_sql_query_bitop_t</a> { <br />
&#160;&#160;<a class="el" href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf">M_SQL_BITOP_AND</a> = 1
, <br />
&#160;&#160;<a class="el" href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944ad355f80e9bd8d62dad2a75dd7dcc4ae2">M_SQL_BITOP_OR</a> = 2
<br />
 }</td></tr>
<tr class="separator:ga37d5f0e16066904bba1519f2117f4944"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gae3a709e6c13fd44cbcb1f8a767a4ffca"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__query.html#gae3a709e6c13fd44cbcb1f8a767a4ffca">M_sql_query_append_updlock</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, <a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *query, <a class="el" href="group__m__sql__query.html#ga6ebebe6fd69e22bb87d506b2c7e4e8f0">M_sql_query_updlock_type_t</a> type, const char *table_name)</td></tr>
<tr class="separator:gae3a709e6c13fd44cbcb1f8a767a4ffca"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga70c65566ff6270f731ef0751c1a9cf39"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__query.html#ga70c65566ff6270f731ef0751c1a9cf39">M_sql_query_append_bitop</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, <a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *query, <a class="el" href="group__m__sql__query.html#ga37d5f0e16066904bba1519f2117f4944">M_sql_query_bitop_t</a> op, const char *exp1, const char *exp2)</td></tr>
<tr class="separator:ga70c65566ff6270f731ef0751c1a9cf39"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gab8568b3a74085a901b930c26c08a53a6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__sql__query.html#gab8568b3a74085a901b930c26c08a53a6">M_sql_query_append_datatype</a> (<a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *pool, <a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *query, <a class="el" href="group__m__sql__error.html#gae672a1a5ceb3af4f3a01347ffd839beb">M_sql_data_type_t</a> type, size_t max_len, M_bool is_cast)</td></tr>
<tr class="separator:gab8568b3a74085a901b930c26c08a53a6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p>SQL Query Extension/Portability Helpers are used to assist in ensuring queries are portable across various database servers utilizing extensions they offer. </p>
<h2 class="groupheader">Enumeration Type Documentation</h2>
<a id="ga6ebebe6fd69e22bb87d506b2c7e4e8f0"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6ebebe6fd69e22bb87d506b2c7e4e8f0">&#9670;&nbsp;</a></span>M_sql_query_updlock_type_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__m__sql__query.html#ga6ebebe6fd69e22bb87d506b2c7e4e8f0">M_sql_query_updlock_type_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Row lock type to append to query to lock rows returned from a select statement for a future update with in a transaction. All values must be used within a single query </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970"></a>M_SQL_QUERY_UPDLOCK_TABLE&#160;</td><td class="fielddoc"><p>Apply SQL-specific lock to rows in the table being updated. This must be appended immediately after every referenced table name when row locking is desired. Must be used in conjunction with a later call for <a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a> </p>
</td></tr>
<tr><td class="fieldname"><a id="gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a"></a>M_SQL_QUERY_UPDLOCK_QUERYEND&#160;</td><td class="fielddoc"><p>Apply the SQL-specific lock to the rows referenced by query, this must always be applied at the END of a query string. Must be used in conjunction with an earlier call for <a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970">M_SQL_QUERY_UPDLOCK_TABLE</a> </p>
</td></tr>
</table>

</div>
</div>
<a id="ga37d5f0e16066904bba1519f2117f4944"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga37d5f0e16066904bba1519f2117f4944">&#9670;&nbsp;</a></span>M_sql_query_bitop_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">enum <a class="el" href="group__m__sql__query.html#ga37d5f0e16066904bba1519f2117f4944">M_sql_query_bitop_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Type of bitwise operation to perform. </p>
<table class="fieldtable">
<tr><th colspan="2">Enumerator</th></tr><tr><td class="fieldname"><a id="gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf"></a>M_SQL_BITOP_AND&#160;</td><td class="fielddoc"><p>Perform a bitwise AND (&amp;) operation </p>
</td></tr>
<tr><td class="fieldname"><a id="gga37d5f0e16066904bba1519f2117f4944ad355f80e9bd8d62dad2a75dd7dcc4ae2"></a>M_SQL_BITOP_OR&#160;</td><td class="fielddoc"><p>Perform a bitwise OR (|) operation </p>
</td></tr>
</table>

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gae3a709e6c13fd44cbcb1f8a767a4ffca"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gae3a709e6c13fd44cbcb1f8a767a4ffca">&#9670;&nbsp;</a></span>M_sql_query_append_updlock()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_sql_query_append_updlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__sql__query.html#ga6ebebe6fd69e22bb87d506b2c7e4e8f0">M_sql_query_updlock_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>table_name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Append the SQL-server-specific row lock method to the proper point in the query to be updated by a later call within the same transaction.</p>
<p>Row locks are intended to block conflicting select statements until the current transaction has completed. It is an optimization to assist in reducing deadlocks which force rollback and retry cycles. For some database clustering solutions, like MySQL/MariaDB with Galera, it is necessary to use to prevent lost updates since updates cross-node lack the serializable isolation level guarantees.</p>
<p>Different databases utilize different row locking methods and the methods appear at different points in the query. Due to the complexity of SQL queries, it is not viable to offer automatic rewrite ability for such queries, and instead we provide methods for simply inserting the locking statements in a DB-specific way into your query.</p>
<p>Locking is for the duration of an SQL transaction, so row locking can only occur within a transaction, please see <a class="el" href="group__m__sql__trans.html#ga6dbb6e001e37950596ccc40f05cedce9">M_sql_trans_begin()</a>.</p>
<p>An example query that you want to lock the rows might look like: </p><div class="fragment"><div class="line">SELECT * FROM <span class="stringliteral">&quot;foo&quot;</span> WHERE <span class="stringliteral">&quot;bar&quot;</span> = ? </div>
</div><!-- fragment --><p> For a row lock for Microsoft SQL Server, the desired query with locks would look like: </p><div class="fragment"><div class="line">SELECT * FROM <span class="stringliteral">&quot;foo&quot;</span> WITH (ROWLOCK, XLOCK, HOLDLOCK) WHERE <span class="stringliteral">&quot;bar&quot;</span> = ? </div>
</div><!-- fragment --><p> For the equivalent on MySQL, it would look like this: </p><div class="fragment"><div class="line">SELECT * FROM <span class="stringliteral">&quot;foo&quot;</span> WHERE <span class="stringliteral">&quot;bar&quot;</span> = ? FOR UPDATE </div>
</div><!-- fragment --><p> For PostgreSQL it may either be like MySQL, or on instances where an outer left join is used a table name must also be specified, e.g. </p><div class="fragment"><div class="line">SELECT * FROM <span class="stringliteral">&quot;foo&quot;</span> WHERE <span class="stringliteral">&quot;bar&quot;</span> = ? FOR UPDATE OF <span class="stringliteral">&quot;foo&quot;</span> </div>
</div><!-- fragment --><p>Clearly as the above example indicates, it would be undesirable to need to rewrite the query manually by detecting the database in use, using helpers makes this easier so you do not need to have SQL-server-specific logic in your own code. Converting that query above using the helpers could be done as the below: </p><div class="fragment"><div class="line"><a class="code" href="group__m__sql__stmt.html#ga4a726e8b7d1b5cffc6f92fdb3e8fb498">M_sql_stmt_t</a> *stmt  = <a class="code" href="group__m__sql__stmt.html#ga744a85528377cd1f7ce17480a2863917">M_sql_stmt_create</a>();</div>
<div class="line"><a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>      *query = <a class="code" href="group__m__buf.html#ga2031dcfdfa76f5feb5a59c8e7ac155d0">M_buf_create</a>();</div>
<div class="line"><a class="code" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> err;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(query, <span class="stringliteral">&quot;SELECT * FROM \&quot;foo\&quot;&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__query.html#gae3a709e6c13fd44cbcb1f8a767a4ffca">M_sql_query_append_updlock</a>(pool, query, <a class="code" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970">M_SQL_QUERY_UPDLOCK_TABLE</a>, NULL);</div>
<div class="line"><a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(query, <span class="stringliteral">&quot; WHERE \&quot;bar\&quot; = ?&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__stmt__bind.html#ga42bdbe9a3de902b6731bd70728ad01cf">M_sql_stmt_bind_int32</a>(stmt, 1);</div>
<div class="line"><a class="code" href="group__m__sql__query.html#gae3a709e6c13fd44cbcb1f8a767a4ffca">M_sql_query_append_updlock</a>(pool, query, <a class="code" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a>, NULL);</div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#ga70c41894d66a3309f0304d1eee7f0688">M_sql_stmt_prepare_buf</a>(stmt, query);</div>
<div class="line">err = <a class="code" href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute</a>(pool, stmt);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#gac33c17989ab52b819ea8a2d5c2962c51">M_sql_stmt_destroy</a>(stmt);</div>
<div class="ttc" id="agroup__m__buf_html_ga2031dcfdfa76f5feb5a59c8e7ac155d0"><div class="ttname"><a href="group__m__buf.html#ga2031dcfdfa76f5feb5a59c8e7ac155d0">M_buf_create</a></div><div class="ttdeci">M_buf_t * M_buf_create(void) M_WARN_UNUSED_RESULT M_MALLOC</div></div>
<div class="ttc" id="agroup__m__buf_html_ga6c543ecf0004fc310faa23c6ed8b267f"><div class="ttname"><a href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a></div><div class="ttdeci">struct M_buf M_buf_t</div><div class="ttdef"><b>Definition:</b> m_buf.h:77</div></div>
<div class="ttc" id="agroup__m__buf_html_gad226a7199f864ff6a630dc7f16508c30"><div class="ttname"><a href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a></div><div class="ttdeci">void M_buf_add_str(M_buf_t *buf, const char *str)</div></div>
<div class="ttc" id="agroup__m__sql__error_html_gaae10ff11eb7d5583afcffa6ec87c753e"><div class="ttname"><a href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a></div><div class="ttdeci">M_sql_error_t</div><div class="ttdef"><b>Definition:</b> m_sql.h:190</div></div>
<div class="ttc" id="agroup__m__sql__query_html_gae3a709e6c13fd44cbcb1f8a767a4ffca"><div class="ttname"><a href="group__m__sql__query.html#gae3a709e6c13fd44cbcb1f8a767a4ffca">M_sql_query_append_updlock</a></div><div class="ttdeci">void M_sql_query_append_updlock(M_sql_connpool_t *pool, M_buf_t *query, M_sql_query_updlock_type_t type, const char *table_name)</div></div>
<div class="ttc" id="agroup__m__sql__query_html_gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970"><div class="ttname"><a href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970">M_SQL_QUERY_UPDLOCK_TABLE</a></div><div class="ttdeci">@ M_SQL_QUERY_UPDLOCK_TABLE</div><div class="ttdef"><b>Definition:</b> m_sql.h:624</div></div>
<div class="ttc" id="agroup__m__sql__query_html_gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a"><div class="ttname"><a href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a></div><div class="ttdeci">@ M_SQL_QUERY_UPDLOCK_QUERYEND</div><div class="ttdef"><b>Definition:</b> m_sql.h:628</div></div>
<div class="ttc" id="agroup__m__sql__stmt__bind_html_ga42bdbe9a3de902b6731bd70728ad01cf"><div class="ttname"><a href="group__m__sql__stmt__bind.html#ga42bdbe9a3de902b6731bd70728ad01cf">M_sql_stmt_bind_int32</a></div><div class="ttdeci">M_sql_error_t M_sql_stmt_bind_int32(M_sql_stmt_t *stmt, M_int32 val)</div></div>
<div class="ttc" id="agroup__m__sql__stmt_html_ga24ff152c4adae378ff4886436706e4eb"><div class="ttname"><a href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute</a></div><div class="ttdeci">M_sql_error_t M_sql_stmt_execute(M_sql_connpool_t *pool, M_sql_stmt_t *stmt)</div></div>
<div class="ttc" id="agroup__m__sql__stmt_html_ga4a726e8b7d1b5cffc6f92fdb3e8fb498"><div class="ttname"><a href="group__m__sql__stmt.html#ga4a726e8b7d1b5cffc6f92fdb3e8fb498">M_sql_stmt_t</a></div><div class="ttdeci">struct M_sql_stmt M_sql_stmt_t</div><div class="ttdef"><b>Definition:</b> m_sql_stmt.h:46</div></div>
<div class="ttc" id="agroup__m__sql__stmt_html_ga70c41894d66a3309f0304d1eee7f0688"><div class="ttname"><a href="group__m__sql__stmt.html#ga70c41894d66a3309f0304d1eee7f0688">M_sql_stmt_prepare_buf</a></div><div class="ttdeci">M_sql_error_t M_sql_stmt_prepare_buf(M_sql_stmt_t *stmt, M_buf_t *query)</div></div>
<div class="ttc" id="agroup__m__sql__stmt_html_ga744a85528377cd1f7ce17480a2863917"><div class="ttname"><a href="group__m__sql__stmt.html#ga744a85528377cd1f7ce17480a2863917">M_sql_stmt_create</a></div><div class="ttdeci">M_sql_stmt_t * M_sql_stmt_create(void)</div></div>
<div class="ttc" id="agroup__m__sql__stmt_html_gac33c17989ab52b819ea8a2d5c2962c51"><div class="ttname"><a href="group__m__sql__stmt.html#gac33c17989ab52b819ea8a2d5c2962c51">M_sql_stmt_destroy</a></div><div class="ttdeci">void M_sql_stmt_destroy(M_sql_stmt_t *stmt)</div></div>
</div><!-- fragment --><dl class="section note"><dt>Note</dt><dd>At least one <a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0ad5d2d238b6f95c5998316db53fedb970">M_SQL_QUERY_UPDLOCK_TABLE</a> must be appended per query. They will be appended immediately after each table reference (SELECT FROM ... table, or JOIN table). For the same query, at the end of the query, <a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a> must be appended.</dd></dl>
<dl class="section warning"><dt>Warning</dt><dd>Not all databases support row-lock hints and instead rely on consistency guarantees by the underlying database for the isolation method in use. If you need these guarantees, please ensure you are using the <a class="el" href="group__m__sql__trans.html#gga38ac042e25fb1159dee3474fb024485da274d1d0e1977c51cbc2f9bdf576eab32">M_SQL_ISOLATION_SERIALIZABLE</a> isolation method as well.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized <a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> object </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">query</td><td>A pointer to an already populated M_buf_t with a partial (or complete for <a class="el" href="group__m__sql__query.html#gga6ebebe6fd69e22bb87d506b2c7e4e8f0aff7c6763b3ed0ab24f605e8fddf4091a">M_SQL_QUERY_UPDLOCK_QUERYEND</a>) request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">type</td><td>Type of sql-specific lock to append to the query. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">table_name</td><td>Optional. For databases that support "FOR UPDATE OF" this will specify the explicit table name to use. If NULL, then will not emit the "OF" clause. This may be necessary for left outer joins on PostgreSQL. Multiple tables may be referenced in a comma-delimited manner, if table aliases are used the alias must be referenced not the actual table name. Table names are NOT automatically quoted. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="ga70c65566ff6270f731ef0751c1a9cf39"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga70c65566ff6270f731ef0751c1a9cf39">&#9670;&nbsp;</a></span>M_sql_query_append_bitop()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_sql_query_append_bitop </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__sql__query.html#ga37d5f0e16066904bba1519f2117f4944">M_sql_query_bitop_t</a>&#160;</td>
          <td class="paramname"><em>op</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exp1</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>exp2</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Perform a bitwise operation on the database using an SQL-server-specific format.</p>
<p>A classic bitwise operation checking to see if a bit is set may look like the below: </p><div class="fragment"><div class="line">(exp1 &amp; exp2) != 0 </div>
</div><!-- fragment --><p>Or a bitwise operation, setting a bit or set of bits may look like: </p><div class="fragment"><div class="line">exp1 = exp1 | exp2 </div>
</div><!-- fragment --><p>Some database servers take the expressions listed above exactly, however, others may require functions like BITAND() and BITOR() to accomplish the same thing.</p>
<p>Taking an example of selecting all rows where "bar" has bit 4 (0x8) set: </p><div class="fragment"><div class="line">SELECT * FROM <span class="stringliteral">&quot;foo&quot;</span> WHERE (<span class="stringliteral">&quot;bar&quot;</span> &amp; 8) &lt;&gt; 0 </div>
</div><!-- fragment --><p> Might look like this: </p><div class="fragment"><div class="line"><a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>      *buf  = <a class="code" href="group__m__buf.html#ga2031dcfdfa76f5feb5a59c8e7ac155d0">M_buf_create</a>();</div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#ga4a726e8b7d1b5cffc6f92fdb3e8fb498">M_sql_stmt_t</a> *stmt = <a class="code" href="group__m__sql__stmt.html#ga744a85528377cd1f7ce17480a2863917">M_sql_stmt_create</a>();</div>
<div class="line"><a class="code" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> err;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(buf, <span class="stringliteral">&quot;SELECT * FROM \&quot;foo\&quot; WHERE (&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__query.html#ga70c65566ff6270f731ef0751c1a9cf39">M_sql_query_append_bitop</a>(pool, buf, <a class="code" href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf">M_SQL_BITOP_AND</a>, <span class="stringliteral">&quot;\&quot;bar\&quot;&quot;</span>, <span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__stmt__bind.html#ga42bdbe9a3de902b6731bd70728ad01cf">M_sql_stmt_bind_int32</a>(stmt, 8);</div>
<div class="line"><a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(buf, <span class="stringliteral">&quot;) &lt;&gt; 0&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#ga70c41894d66a3309f0304d1eee7f0688">M_sql_stmt_prepare_buf</a>(stmt, buf);</div>
<div class="line">err = <a class="code" href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute</a>(pool, stmt);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#gac33c17989ab52b819ea8a2d5c2962c51">M_sql_stmt_destroy</a>(stmt);</div>
<div class="ttc" id="agroup__m__sql__query_html_ga70c65566ff6270f731ef0751c1a9cf39"><div class="ttname"><a href="group__m__sql__query.html#ga70c65566ff6270f731ef0751c1a9cf39">M_sql_query_append_bitop</a></div><div class="ttdeci">M_bool M_sql_query_append_bitop(M_sql_connpool_t *pool, M_buf_t *query, M_sql_query_bitop_t op, const char *exp1, const char *exp2)</div></div>
<div class="ttc" id="agroup__m__sql__query_html_gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf"><div class="ttname"><a href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf">M_SQL_BITOP_AND</a></div><div class="ttdeci">@ M_SQL_BITOP_AND</div><div class="ttdef"><b>Definition:</b> m_sql.h:707</div></div>
</div><!-- fragment --><p>Of course, more complex things are possible as well, such as unsetting bits and setting others in a single request by embedding operations within eachother. Take the below example that keeps bits 2 (0x2) and 3 (0x4) while clearing the rest and also sets bit 4 (0x8): </p><div class="fragment"><div class="line">UPDATE <span class="stringliteral">&quot;foo&quot;</span> SET <span class="stringliteral">&quot;bar&quot;</span> = ( <span class="stringliteral">&quot;bar&quot;</span> &amp; 6 ) | 8; </div>
</div><!-- fragment --><p> Might look like this: </p><div class="fragment"><div class="line"><a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>      *buf  = <a class="code" href="group__m__buf.html#ga2031dcfdfa76f5feb5a59c8e7ac155d0">M_buf_create</a>();</div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#ga4a726e8b7d1b5cffc6f92fdb3e8fb498">M_sql_stmt_t</a> *stmt = <a class="code" href="group__m__sql__stmt.html#ga744a85528377cd1f7ce17480a2863917">M_sql_stmt_create</a>();</div>
<div class="line"><a class="code" href="group__m__sql__error.html#gaae10ff11eb7d5583afcffa6ec87c753e">M_sql_error_t</a> err;</div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(buf, <span class="stringliteral">&quot;UPDATE \&quot;foo\&quot; SET \&quot;bar\&quot; = &quot;</span>);</div>
<div class="line"> </div>
<div class="line">  <span class="comment">// Do inner-first ( &quot;bar&quot; &amp; 6 )</span></div>
<div class="line">  <a class="code" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *inner = <a class="code" href="group__m__buf.html#ga2031dcfdfa76f5feb5a59c8e7ac155d0">M_buf_create</a>();</div>
<div class="line">  <a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(inner, <span class="stringliteral">&quot;( &quot;</span>);</div>
<div class="line">  <a class="code" href="group__m__sql__query.html#ga70c65566ff6270f731ef0751c1a9cf39">M_sql_query_append_bitop</a>(pool, inner, <a class="code" href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944acd8f90df52ba81040a309373b4a836cf">M_SQL_BITOP_AND</a>, <span class="stringliteral">&quot;\&quot;bar\&quot;&quot;</span>, <span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line">  <a class="code" href="group__m__sql__stmt__bind.html#ga42bdbe9a3de902b6731bd70728ad01cf">M_sql_stmt_bind_int32</a>(stmt, 6);</div>
<div class="line">  <a class="code" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(inner, <span class="stringliteral">&quot; )&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Do outer, embedding inner</span></div>
<div class="line"><a class="code" href="group__m__sql__query.html#ga70c65566ff6270f731ef0751c1a9cf39">M_sql_query_append_bitop</a>(pool, buf, <a class="code" href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944ad355f80e9bd8d62dad2a75dd7dcc4ae2">M_SQL_BITOP_OR</a>, <a class="code" href="group__m__buf.html#gaa971e69f90069433ea14d20bf83cc2a4">M_buf_peek</a>(inner), <span class="stringliteral">&quot;?&quot;</span>);</div>
<div class="line"><a class="code" href="group__m__sql__stmt__bind.html#ga42bdbe9a3de902b6731bd70728ad01cf">M_sql_stmt_bind_int32</a>(stmt, 8);</div>
<div class="line"><a class="code" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(inner);  <span class="comment">// We peeked, throw it away</span></div>
<div class="line"> </div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#ga70c41894d66a3309f0304d1eee7f0688">M_sql_stmt_prepare_buf</a>(stmt, buf);</div>
<div class="line">err = <a class="code" href="group__m__sql__stmt.html#ga24ff152c4adae378ff4886436706e4eb">M_sql_stmt_execute</a>(pool, stmt);</div>
<div class="line"><span class="comment">//...</span></div>
<div class="line"><a class="code" href="group__m__sql__stmt.html#gac33c17989ab52b819ea8a2d5c2962c51">M_sql_stmt_destroy</a>(stmt);</div>
<div class="ttc" id="agroup__m__buf_html_gaa971e69f90069433ea14d20bf83cc2a4"><div class="ttname"><a href="group__m__buf.html#gaa971e69f90069433ea14d20bf83cc2a4">M_buf_peek</a></div><div class="ttdeci">const char * M_buf_peek(const M_buf_t *buf)</div></div>
<div class="ttc" id="agroup__m__buf_html_gad51baebd5e46ee8231e78b926ccb198e"><div class="ttname"><a href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a></div><div class="ttdeci">void M_buf_cancel(M_buf_t *buf) M_FREE(1)</div></div>
<div class="ttc" id="agroup__m__sql__query_html_gga37d5f0e16066904bba1519f2117f4944ad355f80e9bd8d62dad2a75dd7dcc4ae2"><div class="ttname"><a href="group__m__sql__query.html#gga37d5f0e16066904bba1519f2117f4944ad355f80e9bd8d62dad2a75dd7dcc4ae2">M_SQL_BITOP_OR</a></div><div class="ttdeci">@ M_SQL_BITOP_OR</div><div class="ttdef"><b>Definition:</b> m_sql.h:708</div></div>
</div><!-- fragment --><dl class="section warning"><dt>Warning</dt><dd>Most databases do not allow bitwise operations to be used for 'truth' values (e.g as a boolean). Instead, an integrator should compare the result to 0 to turn it into a boolean operation if needed.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized <a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> object </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">query</td><td>A pointer to an already populated M_buf_t with a partial request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">op</td><td>Bitwise operation to perform. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exp1</td><td>Left-hand side of SQL expression. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">exp2</td><td>Right-hande size of SQL expression. </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>M_TRUE on success, M_FALSE on misuse </dd></dl>

</div>
</div>
<a id="gab8568b3a74085a901b930c26c08a53a6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gab8568b3a74085a901b930c26c08a53a6">&#9670;&nbsp;</a></span>M_sql_query_append_datatype()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_sql_query_append_datatype </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> *&#160;</td>
          <td class="paramname"><em>pool</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *&#160;</td>
          <td class="paramname"><em>query</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__sql__error.html#gae672a1a5ceb3af4f3a01347ffd839beb">M_sql_data_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>max_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool&#160;</td>
          <td class="paramname"><em>is_cast</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p>It may be necessary to know the data type name mapping for an mstdlib datatype. This function can be used to retrieve that value. Data types may differ depending on an operation. For instance, MySQL can use VARCHAR for column creation but only CHAR for CAST operations </p><dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">pool</td><td>Initialized <a class="el" href="group__m__sql__conn.html#ga36847634817b89efb01054d49e3c6352">M_sql_connpool_t</a> object </td></tr>
    <tr><td class="paramdir">[in,out]</td><td class="paramname">query</td><td>A pointer to an already populated M_buf_t with a partial request. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">type</td><td>mstdlib datatype </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">max_len</td><td>Maximum length of data type if a TEXT or BINARY type. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">is_cast</td><td>If this datatype is used during a CAST operation. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jul 29 2022 14:07:12 for Mstdlib-1.21.0 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
