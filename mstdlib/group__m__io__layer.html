<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.4"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Mstdlib-1.23.0: Functions for creating and using custom I/O layers</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Mstdlib-1.23.0
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.4 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search",'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('group__m__io__layer.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="header">
  <div class="summary">
<a href="#define-members">Macros</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle"><div class="title">Functions for creating and using custom I/O layers<div class="ingroups"><a class="el" href="group__m__eventio.html">Event Based I/O Subsystem</a> &raquo; <a class="el" href="group__m__eventio__semipublic.html">Semi-Public interfaces</a></div></div></div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="define-members" name="define-members"></a>
Macros</h2></td></tr>
<tr class="memitem:gad64f30489df3afe6a46519f135f6cc9c"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gad64f30489df3afe6a46519f135f6cc9c">M_EVENT_HANDLE</a>&#160;&#160;&#160;int</td></tr>
<tr class="separator:gad64f30489df3afe6a46519f135f6cc9c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaad38ecd42f1c7a8411b4e8518a045285"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gaad38ecd42f1c7a8411b4e8518a045285">M_EVENT_INVALID_HANDLE</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:gaad38ecd42f1c7a8411b4e8518a045285"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga1ef77f83c27dd02daf92051706da96e3"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga1ef77f83c27dd02daf92051706da96e3">M_EVENT_SOCKET</a>&#160;&#160;&#160;int</td></tr>
<tr class="separator:ga1ef77f83c27dd02daf92051706da96e3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaca339a57429a3eaabe127c3a3da8f8df"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gaca339a57429a3eaabe127c3a3da8f8df">M_EVENT_INVALID_SOCKET</a>&#160;&#160;&#160;-1</td></tr>
<tr class="separator:gaca339a57429a3eaabe127c3a3da8f8df"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga26df4f9396da636810f70301148989c6"><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga26df4f9396da636810f70301148989c6">M_IO_LAYERS_MAX</a>&#160;&#160;&#160;16</td></tr>
<tr class="separator:ga26df4f9396da636810f70301148989c6"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="typedef-members" name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr class="memitem:ga2c76e456b8335433f53eadfac91e4533"><td class="memItemLeft" align="right" valign="top">typedef struct M_io_layer&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a></td></tr>
<tr class="separator:ga2c76e456b8335433f53eadfac91e4533"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4e34a19e8722fc40cf6074c0fd9131f3"><td class="memItemLeft" align="right" valign="top">typedef struct M_io_handle&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a></td></tr>
<tr class="separator:ga4e34a19e8722fc40cf6074c0fd9131f3"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa3531457bf1cd87643022318658f60c3"><td class="memItemLeft" align="right" valign="top">typedef struct M_io_callbacks&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a></td></tr>
<tr class="separator:gaa3531457bf1cd87643022318658f60c3"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a id="func-members" name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:gac0385457484455f93fa23c2f6ab7c856"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gac0385457484455f93fa23c2f6ab7c856">M_io_layer_acquire</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, size_t layer_id, const char *name)</td></tr>
<tr class="separator:gac0385457484455f93fa23c2f6ab7c856"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4a296392e2a2a26c505575085e4ce177"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga4a296392e2a2a26c505575085e4ce177">M_io_layer_release</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:ga4a296392e2a2a26c505575085e4ce177"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2d0af1d4aa694c0a9b353c6a775e6467"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga2d0af1d4aa694c0a9b353c6a775e6467">M_io_init</a> (<a class="el" href="group__m__io.html#ga7657fac3681f734efc697e3116ee8077">M_io_type_t</a> type)</td></tr>
<tr class="separator:ga2d0af1d4aa694c0a9b353c6a775e6467"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac666dc833a02d04d943fb0415908d914"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io.html#ga7657fac3681f734efc697e3116ee8077">M_io_type_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gac666dc833a02d04d943fb0415908d914">M_io_get_type</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io)</td></tr>
<tr class="separator:gac666dc833a02d04d943fb0415908d914"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaabe9a59e44560a8c52102c637ec27627"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gaabe9a59e44560a8c52102c637ec27627">M_io_callbacks_create</a> (void)</td></tr>
<tr class="separator:gaabe9a59e44560a8c52102c637ec27627"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga8f5d7c26cf5f6d098cfc20c726dbdd04"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga8f5d7c26cf5f6d098cfc20c726dbdd04">M_io_callbacks_reg_init</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, M_bool(*cb_init)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:ga8f5d7c26cf5f6d098cfc20c726dbdd04"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd56f7000fb05fbdbfa7effe4c8acf4b"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gabd56f7000fb05fbdbfa7effe4c8acf4b">M_io_callbacks_reg_accept</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, <a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*cb_accept)(<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *new_conn, <a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *orig_layer))</td></tr>
<tr class="separator:gabd56f7000fb05fbdbfa7effe4c8acf4b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0de59d7872b9a47d2230ff7c6ec0c27c"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, <a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*cb_read)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, unsigned char *buf, size_t *read_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta))</td></tr>
<tr class="separator:ga0de59d7872b9a47d2230ff7c6ec0c27c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gade360ffe79e68306fe3c8911a9ed3358"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, <a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*cb_write)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, const unsigned char *buf, size_t *write_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta))</td></tr>
<tr class="separator:gade360ffe79e68306fe3c8911a9ed3358"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0c3837dbffed3aac4ab6ffa5d3bd4590"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, M_bool(*cb_process_event)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type))</td></tr>
<tr class="separator:ga0c3837dbffed3aac4ab6ffa5d3bd4590"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gabd2d14eb725d528ef98bb8b967ae1e40"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gabd2d14eb725d528ef98bb8b967ae1e40">M_io_callbacks_reg_unregister</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, void(*cb_unregister)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:gabd2d14eb725d528ef98bb8b967ae1e40"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4d4d62d87648fc5d7a76b9e4db81e762"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga4d4d62d87648fc5d7a76b9e4db81e762">M_io_callbacks_reg_disconnect</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, M_bool(*cb_disconnect)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:ga4d4d62d87648fc5d7a76b9e4db81e762"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga9d663c831069a59ca067bf99f6a4bced"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga9d663c831069a59ca067bf99f6a4bced">M_io_callbacks_reg_reset</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, M_bool(*cb_reset)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:ga9d663c831069a59ca067bf99f6a4bced"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga89d597baaffaf2102983258b8c73fe52"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga89d597baaffaf2102983258b8c73fe52">M_io_callbacks_reg_destroy</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, void(*cb_destroy)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:ga89d597baaffaf2102983258b8c73fe52"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga50e5fa28fe89cf44a9565bc929b3b5af"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga50e5fa28fe89cf44a9565bc929b3b5af">M_io_callbacks_reg_state</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, <a class="el" href="group__m__io.html#gad891a3fd8aebdaed3431b834c1ecf345">M_io_state_t</a>(*cb_state)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer))</td></tr>
<tr class="separator:ga50e5fa28fe89cf44a9565bc929b3b5af"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga05ac9b73c65d904407734f6b70da7d43"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga05ac9b73c65d904407734f6b70da7d43">M_io_callbacks_reg_errormsg</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks, M_bool(*cb_errormsg)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, char *error, size_t err_len))</td></tr>
<tr class="separator:ga05ac9b73c65d904407734f6b70da7d43"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga6458e6066300fa9f3cb4dd62e40d200d"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga6458e6066300fa9f3cb4dd62e40d200d">M_io_callbacks_destroy</a> (<a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks)</td></tr>
<tr class="separator:ga6458e6066300fa9f3cb4dd62e40d200d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gaa122109d6ad148d8daae65c0322c4fae"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gaa122109d6ad148d8daae65c0322c4fae">M_io_layer_add</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, const char *layer_name, <a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle, const <a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks)</td></tr>
<tr class="separator:gaa122109d6ad148d8daae65c0322c4fae"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga3b70072aa40efdce81eb6efcde9bfc59"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:ga3b70072aa40efdce81eb6efcde9bfc59"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga769f5a1f4323214bd8b6973707d447b7"><td class="memItemLeft" align="right" valign="top">const char *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga769f5a1f4323214bd8b6973707d447b7">M_io_layer_get_name</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:ga769f5a1f4323214bd8b6973707d447b7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:gac836dc863f54af46a2123fe0cd97bf73"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:gac836dc863f54af46a2123fe0cd97bf73"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga4ed8f7126e4355ebc378bc2aefe710a5"><td class="memItemLeft" align="right" valign="top">size_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:ga4ed8f7126e4355ebc378bc2aefe710a5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga5458358c5cd46f140520b27d0a17db1c"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, size_t layer_id, unsigned char *buf, size_t *read_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</td></tr>
<tr class="separator:ga5458358c5cd46f140520b27d0a17db1c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga2bd63bc8d12ca0735492aebcfc9cb759"><td class="memItemLeft" align="right" valign="top"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, size_t layer_id, const unsigned char *buf, size_t *write_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</td></tr>
<tr class="separator:ga2bd63bc8d12ca0735492aebcfc9cb759"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga15da485fce90d4ec273554a35ec50bfa"><td class="memItemLeft" align="right" valign="top">M_bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a> (<a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> err)</td></tr>
<tr class="separator:ga15da485fce90d4ec273554a35ec50bfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga0c6d9cf0f642515db16a6e85d9285bbe"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga0c6d9cf0f642515db16a6e85d9285bbe">M_io_layer_softevent_add</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, M_bool sibling_only, <a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> type, <a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> err)</td></tr>
<tr class="separator:ga0c6d9cf0f642515db16a6e85d9285bbe"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga91f8925cbfbc6f137b2060db65358748"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga91f8925cbfbc6f137b2060db65358748">M_io_layer_softevent_clear</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</td></tr>
<tr class="separator:ga91f8925cbfbc6f137b2060db65358748"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga418842462a423550ca48a1c6150cc6fd"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga418842462a423550ca48a1c6150cc6fd">M_io_layer_softevent_del</a> (<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, M_bool sibling_only, <a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> type)</td></tr>
<tr class="separator:ga418842462a423550ca48a1c6150cc6fd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ga57d07f7ff756808ff5033b62d2d11c4a"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__m__io__layer.html#ga57d07f7ff756808ff5033b62d2d11c4a">M_io_set_error</a> (<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, <a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> err)</td></tr>
<tr class="separator:ga57d07f7ff756808ff5033b62d2d11c4a"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<p >Included using the semi-public header of &lt;<a class="el" href="m__io__layer_8h_source.html">mstdlib/io/m_io_layer.h</a>&gt;</p>
<p >This is a semi-public header meant for those writing their own io layers. This could be a low level layer that's not current supported for comms. More commonly it would be intermediate layers to accommodate specific data handling.</p>
<h1><a class="anchor" id="autotoc_md68"></a>
Layer Design</h1>
<p >Layers are stacked with the application being on top and the comms layer on the bottom (typically comms later is the bottom layer). Layers in between are typically data processing layers. For example, Application, TLS, and network. Where the TLS layer is an intermediate data processing layer.</p>
<p >Intermediate layers are bidirectional with data flowing down and up.</p>
<h2><a class="anchor" id="autotoc_md69"></a>
Processing Events Callback</h2>
<p >The <code>processevent_cb</code> set by <code><a class="el" href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent()</a></code> flows upward. From the bottom comms layer through the intermediate layer and then to the application layer. This is where data manipulation coming in can be handled. The callback can either allow the even that trigged it to continue up the layer stack or it can suppress the event so no further processing takes place.</p>
<p >For example, if the intermediate layer doesn't need to do any processing of the data or has completed all processing it will allow the event to propagate up. If the layer needs more data before it can be used by the next layer it will suppress the event so processing the event stops.</p>
<p >A read event from <code>processevent_cb</code> needs to read the data from the layer under in order to get the data flowing up to process. A write event needs to write any pending data to the layer under in order for it to be sent out. Read flows up and write flows down.</p>
<p >Events always come from the bottom up. Either the lower layer(s) are stating there is data to read, or it is stating data can be written. If there is no processing of read data or no data to write the events would be allowed to propagate upwards so other layers (or the application) can handle the event.</p>
<p >For processing read events, from the <code>processevent_cb</code> it is necessary to use <code><a class="el" href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read()</a></code> like so <code>M_io_layer_read(io, M_io_layer_get_index(layer) - 1, buf, &amp;buf_len, meta);</code>. Since data is flowing up, the layer under a given layer has the pending read data that needs to be processed.</p>
<p >For processing write events, from the <code>processevent_cb</code> it is necessary to use <code><a class="el" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write()</a></code> like so <code>M_io_layer_write(io, M_io_layer_get_index(layer) - 1, NULL, NULL, meta);</code>. Since data is flowing down, the layer under a given layer has needs to write the pending data.</p>
<p >An application would use <code><a class="el" href="group__m__io.html#gaaf3884f99346e5b40d40bc4bb08dcf5b">M_io_read()</a></code> and <code><a class="el" href="group__m__io.html#gaed538234d26bfea6b0feef33a967860c">M_io_write()</a></code>. These always flow from the top layer down. Since this layer is in the middle we need to always work with the layer beneath.</p>
<h2><a class="anchor" id="autotoc_md70"></a>
Read / Write Callbacks</h2>
<p >The <code>read_cb</code> and <code>write_cb</code> set by <code><a class="el" href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read()</a></code> and <code><a class="el" href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write()</a></code> flow down.</p>
<p >A layer above will call <code>M_io_layer_read</code> or if the top most layer the application would have called <code>M_io_read</code>. These call the layers <code>read_cb</code> If there is no read callback registered the layer is skipped and the next layer in the sequence if called. This happens internally. The <code>read_cb</code> will return any buffered data that has been read and passes it upward. The data is typically buffered via the read event form <code>processevent_cb</code>.</p>
<p >A layer above will call <code>M_io_layer_write</code> or if the top most layer the application would have called <code>M_io_write</code>. These call the layers <code>write_cb</code> If there is no write callback registered the layer is skipped and the next layer in the sequence if called. This happens internally. The <code>write_cb</code> will receive and data that needs to be passed down for writing. Typically, the <code>write_cb</code> will attempt to write the data immediately (after handling any processing) but may need to buffer the data and write more later when the <code>processevent_cb</code> receives a write event stating layers below can accept data to write.</p>
<h2><a class="anchor" id="autotoc_md71"></a>
Examples</h2>
<p >Example layers:</p><ul>
<li>Basic layer that marshals data. Useful for starting a new layer.</li>
<li>Processing STX+ETX+LRC with ACK/NAK and resending message</li>
<li>BLE helper layer that handles secure pairing (if necessary) and setting read/write characteristic endpoints.</li>
</ul>
<h3><a class="anchor" id="autotoc_md72"></a>
Basic</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mstdlib/io/m_io_layer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>M_io_handle {</div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>     *read_buf;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>     *write_buf;</div>
<div class="line">    <span class="keywordtype">char</span>         err[256];</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Writes as much data as possible from the given buffer to the layer below this one.</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_to_next_layer(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *buf)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>       *io;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>  err;</div>
<div class="line">    <span class="keywordtype">size_t</span>        layer_idx;</div>
<div class="line">    <span class="keywordtype">size_t</span>        write_len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (layer == NULL || <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    io        = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    layer_idx = <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (io == NULL || layer_idx == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    err = <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        write_len = <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf);</div>
<div class="line">        err       = <a class="code hl_function" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a>(io, layer_idx - 1, (<span class="keyword">const</span> M_uint8 *)<a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(buf), &amp;write_len, NULL);</div>
<div class="line">        <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">            <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(buf, write_len);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a> &amp;&amp; <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf) &gt; 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool processevent_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle  = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>        *io      = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    M_bool         consume = M_FALSE; <span class="comment">// Default to passing onto the next layer.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>   err;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || io == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (*type) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2">M_EVENT_TYPE_CONNECTED</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9">M_EVENT_TYPE_WRITE</a>:</div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) != 0) {</div>
<div class="line">                err = write_to_next_layer(layer, handle-&gt;write_buf);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">                    <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error writing data: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">                    *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) != 0) {</div>
<div class="line">                    <span class="comment">// Don&#39;t inform higher levels we can write if we have more data pending.</span></div>
<div class="line">                    consume = M_TRUE;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426">M_EVENT_TYPE_READ</a>:</div>
<div class="line">            <span class="comment">// We&#39;re getting data from the device. Let&#39;s pull out the data and check if we want it or not.</span></div>
<div class="line">            <span class="keywordflow">do</span> {</div>
<div class="line">                M_uint8 buf[256] = { 0 };</div>
<div class="line">                <span class="keywordtype">size_t</span>  buf_len  = <span class="keyword">sizeof</span>(buf);</div>
<div class="line"> </div>
<div class="line">                err = <a class="code hl_function" href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read</a>(io, <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer) - 1, buf, &amp;buf_len, NULL);</div>
<div class="line">                <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">                    <span class="comment">// Save the data into the handler&#39;s buffer so we</span></div>
<div class="line">                    <span class="comment">// can pass it up to the layer above in the read callback.</span></div>
<div class="line">                    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;read_buf, buf, buf_len);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">                    <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error reading data: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">                    *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>:</div>
<div class="line">            <a class="code hl_function" href="group__m__io.html#ga3e1f56ec1e586649c1b26eb7c72238de">M_io_get_error_string</a>(io, handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err));</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a571c000a93b3c198364a32e5e145f2d0">M_EVENT_TYPE_ACCEPT</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a6cead05362ca89b2cc7353bf6b4c2c6e">M_EVENT_TYPE_DISCONNECTED</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a89a67d4e5f2bdcadc1ffa3ba0473a6cf">M_EVENT_TYPE_OTHER</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// M_TRUE to discard this event, or M_FALSE to pass it on to the next layer.</span></div>
<div class="line">    <span class="keywordflow">return</span> consume;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> read_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *buf_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    (void)meta;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || buf_len == NULL || *buf_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if we have any more data to pass on or not.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;read_buf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Pass on as much data as possible.</span></div>
<div class="line">    *buf_len = <a class="code hl_define" href="group__m__math.html#ga6237309498df9996986cce08c6550824">M_MIN</a>(*buf_len, <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;read_buf));</div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#ga3ce920591c513671ee62bdb57e846b72">M_mem_copy</a>(buf, <a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;read_buf), *buf_len);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(handle-&gt;read_buf, *buf_len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *buf_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>   err;</div>
<div class="line"> </div>
<div class="line">    (void)meta;</div>
<div class="line"> </div>
<div class="line">    handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || buf_len == NULL || *buf_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Don&#39;t allow buffering data if we have data waiting to write.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) &gt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;write_buf, buf, *buf_len);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Try to write as much of the message as we can right now.</span></div>
<div class="line">    err = write_to_next_layer(layer, handle-&gt;write_buf);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Treat would block as success because we&#39;ve buffered the data and it will</span></div>
<div class="line">     <span class="comment">// be written when possible.</span></div>
<div class="line">    <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>)</div>
<div class="line">        err = <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> unregister_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> M_bool reset_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroy_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;read_buf);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;write_buf);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#gac4b3c1d73d6efe2542f5e729b58a271d">M_free</a>(handle);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool error_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">char</span> *error, <span class="keywordtype">size_t</span> err_len)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__str__check.html#ga530dc6e198ebf9e5c30bc7a28ea4567d">M_str_isempty</a>(handle-&gt;err))</div>
<div class="line">        <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__str__mutate.html#ga050277b36c7f2ea5ff7aa68a0933c6c0">M_str_cpy</a>(error, err_len, handle-&gt;err);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><span class="comment">// --- MAIN ENTRY ---</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> basic_example_layer(<a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a>    *handle;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (io == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    handle             = <a class="code hl_function" href="group__m__mem.html#ga35c94b89c8d56bc0486c91773a0e0b4c">M_malloc_zero</a>(<span class="keyword">sizeof</span>(*handle));</div>
<div class="line">    handle-&gt;read_buf   = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line">    handle-&gt;write_buf  = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line"> </div>
<div class="line">    callbacks = <a class="code hl_function" href="group__m__io__layer.html#gaabe9a59e44560a8c52102c637ec27627">M_io_callbacks_create</a>();</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent</a>(callbacks, processevent_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read</a>(callbacks, read_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write</a>(callbacks, write_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gabd2d14eb725d528ef98bb8b967ae1e40">M_io_callbacks_reg_unregister</a>(callbacks, unregister_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga9d663c831069a59ca067bf99f6a4bced">M_io_callbacks_reg_reset</a>(callbacks, reset_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga89d597baaffaf2102983258b8c73fe52">M_io_callbacks_reg_destroy</a>(callbacks, destroy_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga05ac9b73c65d904407734f6b70da7d43">M_io_callbacks_reg_errormsg</a>(callbacks, error_cb);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gaa122109d6ad148d8daae65c0322c4fae">M_io_layer_add</a>(io, <span class="stringliteral">&quot;BASIC_LAYER&quot;</span>, handle, callbacks);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga6458e6066300fa9f3cb4dd62e40d200d">M_io_callbacks_destroy</a>(callbacks);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__m__buf_html_ga288de250b37d2811d57b8ffe20e89bbc"><div class="ttname"><a href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a></div><div class="ttdeci">void M_buf_add_bytes(M_buf_t *buf, const void *bytes, size_t bytes_length)</div></div>
<div class="ttc" id="agroup__m__buf_html_ga4fc41c9b5746d69a40e8f9aaef53a105"><div class="ttname"><a href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a></div><div class="ttdeci">void M_buf_drop(M_buf_t *buf, size_t num)</div></div>
<div class="ttc" id="agroup__m__buf_html_ga6c543ecf0004fc310faa23c6ed8b267f"><div class="ttname"><a href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a></div><div class="ttdeci">struct M_buf M_buf_t</div><div class="ttdef"><b>Definition:</b> m_buf.h:77</div></div>
<div class="ttc" id="agroup__m__buf_html_ga959ff4d1dd23186caf65086ebcdeaaaa"><div class="ttname"><a href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a></div><div class="ttdeci">const char * M_buf_peek(const M_buf_t *buf)</div></div>
<div class="ttc" id="agroup__m__buf_html_gaaff39362df33795d6c188ca3482a12cd"><div class="ttname"><a href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a></div><div class="ttdeci">size_t M_buf_len(const M_buf_t *buf)</div></div>
<div class="ttc" id="agroup__m__buf_html_gab7bc47e38392716005270b68699c22eb"><div class="ttname"><a href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a></div><div class="ttdeci">M_buf_t * M_buf_create(void) M_WARN_UNUSED_RESULT M_MALLOC</div></div>
<div class="ttc" id="agroup__m__buf_html_gad51baebd5e46ee8231e78b926ccb198e"><div class="ttname"><a href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a></div><div class="ttdeci">void M_buf_cancel(M_buf_t *buf) M_FREE(1)</div></div>
<div class="ttc" id="agroup__m__event_html_ga66b039653a61c8702310d03e6ba69802"><div class="ttname"><a href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a></div><div class="ttdeci">enum M_event_type M_event_type_t</div><div class="ttdef"><b>Definition:</b> m_event.h:189</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9">M_EVENT_TYPE_WRITE</a></div><div class="ttdeci">@ M_EVENT_TYPE_WRITE</div><div class="ttdef"><b>Definition:</b> m_event.h:184</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7a571c000a93b3c198364a32e5e145f2d0"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a571c000a93b3c198364a32e5e145f2d0">M_EVENT_TYPE_ACCEPT</a></div><div class="ttdeci">@ M_EVENT_TYPE_ACCEPT</div><div class="ttdef"><b>Definition:</b> m_event.h:174</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7a6cead05362ca89b2cc7353bf6b4c2c6e"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a6cead05362ca89b2cc7353bf6b4c2c6e">M_EVENT_TYPE_DISCONNECTED</a></div><div class="ttdeci">@ M_EVENT_TYPE_DISCONNECTED</div><div class="ttdef"><b>Definition:</b> m_event.h:176</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7a89a67d4e5f2bdcadc1ffa3ba0473a6cf"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a89a67d4e5f2bdcadc1ffa3ba0473a6cf">M_EVENT_TYPE_OTHER</a></div><div class="ttdeci">@ M_EVENT_TYPE_OTHER</div><div class="ttdef"><b>Definition:</b> m_event.h:185</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426">M_EVENT_TYPE_READ</a></div><div class="ttdeci">@ M_EVENT_TYPE_READ</div><div class="ttdef"><b>Definition:</b> m_event.h:175</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2">M_EVENT_TYPE_CONNECTED</a></div><div class="ttdeci">@ M_EVENT_TYPE_CONNECTED</div><div class="ttdef"><b>Definition:</b> m_event.h:173</div></div>
<div class="ttc" id="agroup__m__event_html_gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac"><div class="ttname"><a href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a></div><div class="ttdeci">@ M_EVENT_TYPE_ERROR</div><div class="ttdef"><b>Definition:</b> m_event.h:181</div></div>
<div class="ttc" id="agroup__m__fmt_html_ga148cb889ab2737a09ebf313e7a3d454b"><div class="ttname"><a href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a></div><div class="ttdeci">size_t M_snprintf(char *buf, size_t size, const char *fmt,...)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga05ac9b73c65d904407734f6b70da7d43"><div class="ttname"><a href="group__m__io__layer.html#ga05ac9b73c65d904407734f6b70da7d43">M_io_callbacks_reg_errormsg</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_errormsg(M_io_callbacks_t *callbacks, M_bool(*cb_errormsg)(M_io_layer_t *layer, char *error, size_t err_len))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga0c3837dbffed3aac4ab6ffa5d3bd4590"><div class="ttname"><a href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_processevent(M_io_callbacks_t *callbacks, M_bool(*cb_process_event)(M_io_layer_t *layer, M_event_type_t *type))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga0de59d7872b9a47d2230ff7c6ec0c27c"><div class="ttname"><a href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_read(M_io_callbacks_t *callbacks, M_io_error_t(*cb_read)(M_io_layer_t *layer, unsigned char *buf, size_t *read_len, M_io_meta_t *meta))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga15da485fce90d4ec273554a35ec50bfa"><div class="ttname"><a href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a></div><div class="ttdeci">M_bool M_io_error_is_critical(M_io_error_t err)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga2bd63bc8d12ca0735492aebcfc9cb759"><div class="ttname"><a href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a></div><div class="ttdeci">M_io_error_t M_io_layer_write(M_io_t *io, size_t layer_id, const unsigned char *buf, size_t *write_len, M_io_meta_t *meta)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga2c76e456b8335433f53eadfac91e4533"><div class="ttname"><a href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a></div><div class="ttdeci">struct M_io_layer M_io_layer_t</div><div class="ttdef"><b>Definition:</b> m_io_layer.h:1086</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga3b70072aa40efdce81eb6efcde9bfc59"><div class="ttname"><a href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a></div><div class="ttdeci">M_io_t * M_io_layer_get_io(M_io_layer_t *layer)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga4e34a19e8722fc40cf6074c0fd9131f3"><div class="ttname"><a href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a></div><div class="ttdeci">struct M_io_handle M_io_handle_t</div><div class="ttdef"><b>Definition:</b> m_io_layer.h:1089</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga4ed8f7126e4355ebc378bc2aefe710a5"><div class="ttname"><a href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a></div><div class="ttdeci">size_t M_io_layer_get_index(M_io_layer_t *layer)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga5458358c5cd46f140520b27d0a17db1c"><div class="ttname"><a href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read</a></div><div class="ttdeci">M_io_error_t M_io_layer_read(M_io_t *io, size_t layer_id, unsigned char *buf, size_t *read_len, M_io_meta_t *meta)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga6458e6066300fa9f3cb4dd62e40d200d"><div class="ttname"><a href="group__m__io__layer.html#ga6458e6066300fa9f3cb4dd62e40d200d">M_io_callbacks_destroy</a></div><div class="ttdeci">void M_io_callbacks_destroy(M_io_callbacks_t *callbacks)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga89d597baaffaf2102983258b8c73fe52"><div class="ttname"><a href="group__m__io__layer.html#ga89d597baaffaf2102983258b8c73fe52">M_io_callbacks_reg_destroy</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_destroy(M_io_callbacks_t *callbacks, void(*cb_destroy)(M_io_layer_t *layer))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga9d663c831069a59ca067bf99f6a4bced"><div class="ttname"><a href="group__m__io__layer.html#ga9d663c831069a59ca067bf99f6a4bced">M_io_callbacks_reg_reset</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_reset(M_io_callbacks_t *callbacks, M_bool(*cb_reset)(M_io_layer_t *layer))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gaa122109d6ad148d8daae65c0322c4fae"><div class="ttname"><a href="group__m__io__layer.html#gaa122109d6ad148d8daae65c0322c4fae">M_io_layer_add</a></div><div class="ttdeci">M_io_layer_t * M_io_layer_add(M_io_t *io, const char *layer_name, M_io_handle_t *handle, const M_io_callbacks_t *callbacks)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gaa3531457bf1cd87643022318658f60c3"><div class="ttname"><a href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a></div><div class="ttdeci">struct M_io_callbacks M_io_callbacks_t</div><div class="ttdef"><b>Definition:</b> m_io_layer.h:1092</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gaabe9a59e44560a8c52102c637ec27627"><div class="ttname"><a href="group__m__io__layer.html#gaabe9a59e44560a8c52102c637ec27627">M_io_callbacks_create</a></div><div class="ttdeci">M_io_callbacks_t * M_io_callbacks_create(void)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gabd2d14eb725d528ef98bb8b967ae1e40"><div class="ttname"><a href="group__m__io__layer.html#gabd2d14eb725d528ef98bb8b967ae1e40">M_io_callbacks_reg_unregister</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_unregister(M_io_callbacks_t *callbacks, void(*cb_unregister)(M_io_layer_t *layer))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gac836dc863f54af46a2123fe0cd97bf73"><div class="ttname"><a href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a></div><div class="ttdeci">M_io_handle_t * M_io_layer_get_handle(M_io_layer_t *layer)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gade360ffe79e68306fe3c8911a9ed3358"><div class="ttname"><a href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_write(M_io_callbacks_t *callbacks, M_io_error_t(*cb_write)(M_io_layer_t *layer, const unsigned char *buf, size_t *write_len, M_io_meta_t *meta))</div></div>
<div class="ttc" id="agroup__m__io_html_ga2d3bea9aaa4491c3c8dad94cf24498a2"><div class="ttname"><a href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a></div><div class="ttdeci">enum M_io_error M_io_error_t</div><div class="ttdef"><b>Definition:</b> m_io.h:93</div></div>
<div class="ttc" id="agroup__m__io_html_ga3e1f56ec1e586649c1b26eb7c72238de"><div class="ttname"><a href="group__m__io.html#ga3e1f56ec1e586649c1b26eb7c72238de">M_io_get_error_string</a></div><div class="ttdeci">void M_io_get_error_string(M_io_t *io, char *error, size_t err_len)</div></div>
<div class="ttc" id="agroup__m__io_html_ga845c131d8520206a2a7a9219d1bd1932"><div class="ttname"><a href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a></div><div class="ttdeci">struct M_io M_io_t</div><div class="ttdef"><b>Definition:</b> m_io.h:59</div></div>
<div class="ttc" id="agroup__m__io_html_ga9b9493ef60e89fbb37537ec239ab2724"><div class="ttname"><a href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a></div><div class="ttdeci">struct M_io_meta M_io_meta_t</div><div class="ttdef"><b>Definition:</b> m_io.h:64</div></div>
<div class="ttc" id="agroup__m__io_html_gab4e93021ae39b99bbe311ed7c45676d3"><div class="ttname"><a href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a></div><div class="ttdeci">const char * M_io_error_string(M_io_error_t error)</div></div>
<div class="ttc" id="agroup__m__io_html_gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30"><div class="ttname"><a href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a></div><div class="ttdeci">@ M_IO_ERROR_SUCCESS</div><div class="ttdef"><b>Definition:</b> m_io.h:69</div></div>
<div class="ttc" id="agroup__m__io_html_gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c"><div class="ttname"><a href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a></div><div class="ttdeci">@ M_IO_ERROR_WOULDBLOCK</div><div class="ttdef"><b>Definition:</b> m_io.h:70</div></div>
<div class="ttc" id="agroup__m__io_html_gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3"><div class="ttname"><a href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a></div><div class="ttdeci">@ M_IO_ERROR_INVALID</div><div class="ttdef"><b>Definition:</b> m_io.h:83</div></div>
<div class="ttc" id="agroup__m__math_html_ga6237309498df9996986cce08c6550824"><div class="ttname"><a href="group__m__math.html#ga6237309498df9996986cce08c6550824">M_MIN</a></div><div class="ttdeci">#define M_MIN(a, b)</div><div class="ttdef"><b>Definition:</b> m_math.h:44</div></div>
<div class="ttc" id="agroup__m__mem_html_ga35c94b89c8d56bc0486c91773a0e0b4c"><div class="ttname"><a href="group__m__mem.html#ga35c94b89c8d56bc0486c91773a0e0b4c">M_malloc_zero</a></div><div class="ttdeci">void * M_malloc_zero(size_t size) M_ALLOC_SIZE(1) M_WARN_UNUSED_RESULT M_MALLOC</div></div>
<div class="ttc" id="agroup__m__mem_html_ga3ce920591c513671ee62bdb57e846b72"><div class="ttname"><a href="group__m__mem.html#ga3ce920591c513671ee62bdb57e846b72">M_mem_copy</a></div><div class="ttdeci">void * M_mem_copy(void *dst, const void *src, size_t size)</div></div>
<div class="ttc" id="agroup__m__mem_html_gac4b3c1d73d6efe2542f5e729b58a271d"><div class="ttname"><a href="group__m__mem.html#gac4b3c1d73d6efe2542f5e729b58a271d">M_free</a></div><div class="ttdeci">void M_free(void *ptr) M_FREE(1)</div></div>
<div class="ttc" id="agroup__m__str__check_html_ga530dc6e198ebf9e5c30bc7a28ea4567d"><div class="ttname"><a href="group__m__str__check.html#ga530dc6e198ebf9e5c30bc7a28ea4567d">M_str_isempty</a></div><div class="ttdeci">M_bool M_str_isempty(const char *s) M_WARN_UNUSED_RESULT</div></div>
<div class="ttc" id="agroup__m__str__mutate_html_ga050277b36c7f2ea5ff7aa68a0933c6c0"><div class="ttname"><a href="group__m__str__mutate.html#ga050277b36c7f2ea5ff7aa68a0933c6c0">M_str_cpy</a></div><div class="ttdeci">M_bool M_str_cpy(char *dest, size_t dest_len, const char *src)</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md73"></a>
STX + ETX + LRC with ACK / NAK and resending</h3>
<div class="fragment"><div class="line"><span class="comment">// IO Layer for generating and unwrapping STX+ETX+LRC with ACK/NAK messaging.</span></div>
<div class="line"><span class="comment">// Supports resending message if no response is received within a specified time.</span></div>
<div class="line"><span class="comment">// Will only resent X times before giving up and erring.</span></div>
<div class="line"> </div>
<div class="line"><span class="preprocessor">#include &lt;mstdlib/mstdlib.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;mstdlib/io/m_io_layer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>M_io_handle {</div>
<div class="line">    <span class="comment">// Read.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__parser.html#ga60164be64f8c962c795e5927642fc473">M_parser_t</a>      *readparser;   <span class="comment">// Buffer containing message that&#39;s currently being stitched together from packets.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>         *readbuf;      <span class="comment">// Buffer containing message that&#39;s currently being consumed by the caller.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>         *last_msg;     <span class="comment">// Last buffered message, used for resend if ACK not received.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>         *writebuf;     <span class="comment">// Buffer containing message that&#39;s currently being consumed by the caller.</span></div>
<div class="line">    M_bool           can_write;    <span class="comment">// Whether we can write more data. We only allow 1 outstanding message at a time.</span></div>
<div class="line"> </div>
<div class="line">    <span class="keywordtype">size_t</span>           resend_cnt;   <span class="comment">// Number of times we&#39;ve tried resending the message.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__event.html#gaf7cc7058deaf2fd06e4a4733d16c9b52">M_event_timer_t</a> *resend_timer; <span class="comment">// Timer to track when a response hasn&#39;t been received and the message should be resent.</span></div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Error</span></div>
<div class="line">    <span class="keywordtype">char</span>             err[256];     <span class="comment">// Error message buffer.</span></div>
<div class="line">}; <span class="comment">// Typedef&#39;d to M_io_handle_t in m_io_layer.h</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>          *LAYER_NAME      = <span class="stringliteral">&quot;STXETXLRCACKNAK&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span>         RESEND_MAX      = 5;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">size_t</span>         RESEND_INTERVAL = 3*1000; <span class="comment">// 3 seconds</span></div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>          *STX_STR         = <span class="stringliteral">&quot;\x02&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>          *ACK_STR         = <span class="stringliteral">&quot;\x06&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span>          *NAK_STR         = <span class="stringliteral">&quot;\x15&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  STX             = 0x02;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  ETX             = 0x03;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  ACK             = 0x06;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  NAK             = 0x15;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_int(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>       *io;</div>
<div class="line">    <span class="keywordtype">size_t</span>        layer_idx;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>  err       = <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">    <span class="keywordtype">size_t</span>        write_len = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (layer == NULL || handle == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line"> </div>
<div class="line">    io        = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    layer_idx = <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (io == NULL || layer_idx == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a> &amp;&amp; <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf) &gt; 0) {</div>
<div class="line">        write_len = <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf);</div>
<div class="line">        err = <a class="code hl_function" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a>(io, layer_idx-1, (<span class="keyword">const</span> M_uint8 *)<a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;writebuf), &amp;write_len, meta);</div>
<div class="line">        <span class="keywordflow">if</span> (err != <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">            write_len = 0;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(handle-&gt;writebuf, write_len);</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a> &amp;&amp; <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf) == 0 &amp;&amp; handle-&gt;can_write)</div>
<div class="line">        <a class="code hl_function" href="group__m__io__layer.html#ga0c6d9cf0f642515db16a6e85d9285bbe">M_io_layer_softevent_add</a>(layer, M_TRUE, <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9">M_EVENT_TYPE_WRITE</a>, <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf) == 0)</div>
<div class="line">        <a class="code hl_function" href="group__m__event.html#ga2809669810c4005a6750c4dfe21bf8a5">M_event_timer_start</a>(handle-&gt;resend_timer, RESEND_INTERVAL);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> resend_message(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_function" href="group__m__event.html#ga7cc2ffa4f595f828e84a0a42eb3bbabb">M_event_timer_stop</a>(handle-&gt;resend_timer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle-&gt;resend_cnt &gt;= RESEND_MAX) {</div>
<div class="line">        <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Timeout: Exceeded resent attempts&quot;</span>);</div>
<div class="line">        <a class="code hl_function" href="group__m__io__layer.html#ga0c6d9cf0f642515db16a6e85d9285bbe">M_io_layer_softevent_add</a>(layer, M_TRUE, <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>, <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba95386ec441cd9e0e5ca62a61881531ea">M_IO_ERROR_TIMEDOUT</a>);</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a>(<span class="stringliteral">&quot;%s: RESEND!&quot;</span>, LAYER_NAME);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write the last message again.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga2eea65131f3d534ac2eca625808007e1">M_buf_truncate</a>(handle-&gt;writebuf, 0);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;writebuf, <a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;last_msg), <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;last_msg));</div>
<div class="line">    write_int(layer, handle, NULL);</div>
<div class="line"> </div>
<div class="line">    handle-&gt;resend_cnt++;</div>
<div class="line">    <span class="comment">// Restart the resend timer and try again.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__event.html#ga2809669810c4005a6750c4dfe21bf8a5">M_event_timer_start</a>(handle-&gt;resend_timer, RESEND_INTERVAL);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> resend_cb(<a class="code hl_typedef" href="group__m__event.html#ga747f0301bfcc6db3b51eaf07e2582350">M_event_t</a> *el, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> etype, <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, <span class="keywordtype">void</span> *thunk)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a>  *layer  = thunk;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    (void)el;</div>
<div class="line">    (void)io;</div>
<div class="line">    (void)etype;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a>(<span class="stringliteral">&quot;%s: NO RESPONSE!&quot;</span>, LAYER_NAME);</div>
<div class="line">    resend_message(layer, handle);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *create_handle(<span class="keywordtype">void</span>)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle;</div>
<div class="line"> </div>
<div class="line">    handle                  = <a class="code hl_function" href="group__m__mem.html#ga35c94b89c8d56bc0486c91773a0e0b4c">M_malloc_zero</a>(<span class="keyword">sizeof</span>(*handle));</div>
<div class="line">    handle-&gt;readparser      = <a class="code hl_function" href="group__m__parser.html#ga9713ad1ff5db4ec0cc5d2fa994ef9d23">M_parser_create</a>(<a class="code hl_enumvalue" href="group__m__parser.html#gga5f283601804b657a199f6574996ccf87a5879ad8c9fea3f4031268d7917b03933">M_PARSER_FLAG_NONE</a>);</div>
<div class="line">    handle-&gt;readbuf         = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line">    handle-&gt;writebuf        = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line">    handle-&gt;last_msg        = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line">    handle-&gt;can_write       = M_TRUE;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> handle;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroy_handle(<a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__parser.html#ga3cd7b444d6f5058b149bc4c7262d5cb7">M_parser_destroy</a>(handle-&gt;readparser);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;readbuf);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;writebuf);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;last_msg);</div>
<div class="line">    <a class="code hl_function" href="group__m__event.html#ga45d217b7fc4c1310975855ccc2b894e9">M_event_timer_remove</a>(handle-&gt;resend_timer);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#gac4b3c1d73d6efe2542f5e729b58a271d">M_free</a>(handle);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool process_message(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__parser.html#ga60164be64f8c962c795e5927642fc473">M_parser_t</a>           *msg_parser  = NULL;</div>
<div class="line">    <a class="code hl_enumeration" href="group__m__parser.html#ga6993008e1f0881f84431d5813f33d127">M_PARSER_FRAME_ERROR</a>  frame_error;</div>
<div class="line">    <span class="keywordtype">size_t</span>                len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a>(handle-&gt;readparser) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// NAK means we need to send the last message again.</span></div>
<div class="line">    len = <a class="code hl_function" href="group__m__parser.html#ga94d17dbc917bc704c9fea3030e1f8b45">M_parser_consume_charset</a>(handle-&gt;readparser, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)NAK_STR, 1);</div>
<div class="line">    <span class="keywordflow">if</span> (len != 0) {</div>
<div class="line">        <a class="code hl_function" href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a>(<span class="stringliteral">&quot;%s: NAK!&quot;</span>, LAYER_NAME);</div>
<div class="line">        resend_message(layer, handle);</div>
<div class="line">        <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Got something that&#39;s not a NAK.</span></div>
<div class="line">     <span class="comment">// Even if it&#39;s not an ACK we&#39;ll consider</span></div>
<div class="line">    <span class="comment">// the last message we sent processed.</span></div>
<div class="line">    handle-&gt;resend_cnt = 0;</div>
<div class="line">    <a class="code hl_function" href="group__m__event.html#ga7cc2ffa4f595f828e84a0a42eb3bbabb">M_event_timer_stop</a>(handle-&gt;resend_timer);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga2eea65131f3d534ac2eca625808007e1">M_buf_truncate</a>(handle-&gt;last_msg, 0);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// ACK tells us we can write more data.</span></div>
<div class="line">    len = <a class="code hl_function" href="group__m__parser.html#ga94d17dbc917bc704c9fea3030e1f8b45">M_parser_consume_charset</a>(handle-&gt;readparser, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)ACK_STR, 1);</div>
<div class="line">    <span class="keywordflow">if</span> (len &gt; 1)</div>
<div class="line">        handle-&gt;can_write = M_TRUE;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We could have garbage that will be ignored.</span></div>
<div class="line">    len = <a class="code hl_function" href="group__m__parser.html#ga64dd85cefe6dc965fde7532de8710957">M_parser_consume_not_charset</a>(handle-&gt;readparser, (<span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *)STX_STR, 1);</div>
<div class="line">    <span class="keywordflow">if</span> (len &gt; 0)</div>
<div class="line">        <a class="code hl_function" href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a>(<span class="stringliteral">&quot;%s: Unexpected data was dropped (%zu bytes)&quot;</span>, LAYER_NAME, len);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// We either have an STX at the start or no data. We also need at least 4 bytes of data to have a framed message.</span></div>
<div class="line">     <span class="comment">// We could have only received an ACK earlier and not need to process any data.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a>(handle-&gt;readparser) &lt; 4)</div>
<div class="line">        <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Pull the data out of the wrapper.</span></div>
<div class="line">    frame_error = <a class="code hl_function" href="group__m__parser.html#ga92fee6f3045a04e33a5c075f09e72ba3">M_parser_read_stxetxlrc_message</a>(handle-&gt;readparser, &amp;msg_parser, <a class="code hl_enumvalue" href="group__m__parser.html#gga3fbdc774c77f61b74f797598209b682caf93ba74fbec931a58ad1f78964572720">M_PARSER_FRAME_ETX</a>);</div>
<div class="line">    <span class="keywordflow">if</span> (frame_error != <a class="code hl_enumvalue" href="group__m__parser.html#gga6993008e1f0881f84431d5813f33d127a1163baeeb38554303ed45fed0edb15fc">M_PARSER_FRAME_ERROR_SUCCESS</a>) {</div>
<div class="line">        <span class="comment">// M_PARSER_FRAME_ERROR_INVALID, M_PARSER_FRAME_ERROR_NO_ETX, and M_PARSER_FRAME_ERROR_NO_LRC indicating needing more data</span></div>
<div class="line">         <span class="comment">// will result in waiting for more data to come in. M_PARSER_FRAME_ERROR_NO_STX shouldn&#39;t happen because</span></div>
<div class="line">        <span class="comment">// we&#39;ve already validated the first character is an STX. M_PARSER_FRAME_ERROR_LRC_CALC_FAILED is a real faulre.</span></div>
<div class="line">        <span class="keywordflow">if</span> (frame_error == <a class="code hl_enumvalue" href="group__m__parser.html#gga6993008e1f0881f84431d5813f33d127a701af53f85eb9dfd398ba8200b4d4059">M_PARSER_FRAME_ERROR_LRC_CALC_FAILED</a>) {</div>
<div class="line">            <a class="code hl_function" href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a>(<span class="stringliteral">&quot;%s: Message LRC verification failed: dropped (%zu bytes)&quot;</span>, LAYER_NAME, <a class="code hl_function" href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a>(msg_parser));</div>
<div class="line"> </div>
<div class="line">            <a class="code hl_function" href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a>(handle-&gt;writebuf, NAK);</div>
<div class="line">            write_int(layer, handle, NULL);</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_function" href="group__m__parser.html#ga3cd7b444d6f5058b149bc4c7262d5cb7">M_parser_destroy</a>(msg_parser);</div>
<div class="line">        <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Store the data.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;readbuf, <a class="code hl_function" href="group__m__parser.html#ga65cd501b432d08fb599afbd732ca58f4">M_parser_peek</a>(msg_parser), <a class="code hl_function" href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a>(msg_parser));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write an ACK.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a>(handle-&gt;writebuf, ACK);</div>
<div class="line">    write_int(layer, handle, NULL);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__parser.html#ga3cd7b444d6f5058b149bc4c7262d5cb7">M_parser_destroy</a>(msg_parser);</div>
<div class="line">    <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool handle_read(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>        *io        = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    M_bool         discard   = M_TRUE; <span class="comment">// Default to processing and then discarding all events</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>   err;</div>
<div class="line">    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>  buf[8192] = { 0 };</div>
<div class="line">    <span class="keywordtype">size_t</span>         len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        len = <span class="keyword">sizeof</span>(buf);</div>
<div class="line">        err = <a class="code hl_function" href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read</a>(io, <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer)-1, buf, &amp;len, NULL); </div>
<div class="line"> </div>
<div class="line">        <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">            <a class="code hl_function" href="group__m__parser.html#ga391a35eb1787b282c73eb1021dc33c2b">M_parser_append</a>(handle-&gt;readparser, buf, len);</div>
<div class="line">            discard = process_message(layer, handle);</div>
<div class="line">        } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">            <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error reading message: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">            *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> discard;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool handle_write(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> err;</div>
<div class="line"> </div>
<div class="line">    err = write_int(layer, handle, NULL);</div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">        <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error writing message: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">        *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">        <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> read_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *read_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle;</div>
<div class="line">    <span class="keywordtype">size_t</span>         bytes_left;</div>
<div class="line"> </div>
<div class="line">    (void)meta;</div>
<div class="line"> </div>
<div class="line">    handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Zero-length reads are not allowed.</span></div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || read_len == NULL || *read_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Process any outstanding messages and fill our read out buffer.</span></div>
<div class="line">    process_message(layer, handle);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if we have a full message.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;readbuf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Read everything we can.</span></div>
<div class="line">    bytes_left = <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;readbuf);</div>
<div class="line">    *read_len  = <a class="code hl_define" href="group__m__math.html#ga6237309498df9996986cce08c6550824">M_MIN</a>(*read_len, bytes_left);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#ga3ce920591c513671ee62bdb57e846b72">M_mem_copy</a>(buf, <a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;readbuf), *read_len);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(handle-&gt;readbuf, *read_len);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// If we still have data available to read (needs to be processed)</span></div>
<div class="line">     <span class="comment">// send another read event.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a>(handle-&gt;readparser) &gt; 0)</div>
<div class="line">        <a class="code hl_function" href="group__m__io__layer.html#ga0c6d9cf0f642515db16a6e85d9285bbe">M_io_layer_softevent_add</a>(layer, M_TRUE, <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426">M_EVENT_TYPE_READ</a>, <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *buf_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a>  *handle      = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>         *io          = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    <span class="keywordtype">size_t</span>          mywrite_len = 0;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || buf_len == NULL || *buf_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf) &gt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Wrap the message in &quot;&lt;stx&gt; + &lt;data&gt; + &lt;etx&gt; + &lt;lrc&gt;&quot;</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a>(handle-&gt;writebuf, STX);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;writebuf, buf, *buf_len);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a>(handle-&gt;writebuf, ETX);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a>(handle-&gt;writebuf, <a class="code hl_function" href="group__m__mem.html#ga8a11dc1aa0bc31f10a1289043464f966">M_mem_calc_lrc</a>(<a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;writebuf)+1, <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf)-1));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Store this message in case we need to resend because writebuf will be truncated as data gets sent.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga2eea65131f3d534ac2eca625808007e1">M_buf_truncate</a>(handle-&gt;last_msg, 0);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;last_msg, <a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;writebuf), <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;writebuf));</div>
<div class="line"> </div>
<div class="line">    handle-&gt;can_write = M_FALSE;</div>
<div class="line">    <span class="keywordflow">return</span> write_int(layer, handle, meta);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool processevent_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>        *io     = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    <span class="keyword">const</span> <span class="keywordtype">char</span>    *estr;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (*type) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2">M_EVENT_TYPE_CONNECTED</a>:</div>
<div class="line">            handle-&gt;can_write = M_TRUE;</div>
<div class="line">            <span class="comment">// Fall thru</span></div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9">M_EVENT_TYPE_WRITE</a>:</div>
<div class="line">            <span class="keywordflow">return</span> handle_write(layer, handle, type);</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426">M_EVENT_TYPE_READ</a>:</div>
<div class="line">            <span class="keywordflow">return</span> handle_read(layer, handle, type);</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a6cead05362ca89b2cc7353bf6b4c2c6e">M_EVENT_TYPE_DISCONNECTED</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a571c000a93b3c198364a32e5e145f2d0">M_EVENT_TYPE_ACCEPT</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a89a67d4e5f2bdcadc1ffa3ba0473a6cf">M_EVENT_TYPE_OTHER</a>:</div>
<div class="line">            <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool error_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">char</span> *error, <span class="keywordtype">size_t</span> err_len)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__str__check.html#ga530dc6e198ebf9e5c30bc7a28ea4567d">M_str_isempty</a>(handle-&gt;err))</div>
<div class="line">        <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__str__mutate.html#ga050277b36c7f2ea5ff7aa68a0933c6c0">M_str_cpy</a>(error, err_len, handle-&gt;err);</div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool init_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>        *io     = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle-&gt;resend_timer != NULL)</div>
<div class="line">        <a class="code hl_function" href="group__m__event.html#ga45d217b7fc4c1310975855ccc2b894e9">M_event_timer_remove</a>(handle-&gt;resend_timer);</div>
<div class="line">    handle-&gt;resend_timer = <a class="code hl_function" href="group__m__event.html#ga4b2788bfa150ff1bc6e2d4d2d7d05872">M_event_timer_add</a>(<a class="code hl_function" href="group__m__event.html#ga723018dc05c3b0ec6da531eb1788b86c">M_io_get_event</a>(io), resend_cb, layer);</div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> unregister_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> M_bool reset_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroy_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (layer == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line">    destroy_handle(<a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer));</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><span class="comment">// --- MAIN ENTRY ---</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> stxetxlrcacknak_io_layer(<a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, M_bool reconnect)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a>    *handle    = create_handle();</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks = <a class="code hl_function" href="group__m__io__layer.html#gaabe9a59e44560a8c52102c637ec27627">M_io_callbacks_create</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga8f5d7c26cf5f6d098cfc20c726dbdd04">M_io_callbacks_reg_init</a>(callbacks, init_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read</a>(callbacks, read_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write</a>(callbacks, write_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent</a>(callbacks, processevent_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gabd2d14eb725d528ef98bb8b967ae1e40">M_io_callbacks_reg_unregister</a>(callbacks, unregister_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga9d663c831069a59ca067bf99f6a4bced">M_io_callbacks_reg_reset</a>(callbacks, reset_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga89d597baaffaf2102983258b8c73fe52">M_io_callbacks_reg_destroy</a>(callbacks, destroy_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga05ac9b73c65d904407734f6b70da7d43">M_io_callbacks_reg_errormsg</a>(callbacks, error_cb);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gaa122109d6ad148d8daae65c0322c4fae">M_io_layer_add</a>(io, LAYER_NAME, handle, callbacks);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga6458e6066300fa9f3cb4dd62e40d200d">M_io_callbacks_destroy</a>(callbacks);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line">M_bool stxetxlrcacknak_layer_waiting_for_response(<a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordtype">size_t</span> layer_count;</div>
<div class="line">    <span class="keywordtype">size_t</span> layer_idx;</div>
<div class="line">    M_bool ret = M_FALSE;</div>
<div class="line"> </div>
<div class="line">    layer_count = <a class="code hl_function" href="group__m__io.html#gab85f18fea241a1a9eb2f6ba966e5c892">M_io_layer_count</a>(io);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">for</span> (layer_idx=0; layer_idx&lt;layer_count; layer_idx++) {</div>
<div class="line">        <a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer = <a class="code hl_function" href="group__m__io__layer.html#gac0385457484455f93fa23c2f6ab7c856">M_io_layer_acquire</a>(io, layer_idx, LAYER_NAME);</div>
<div class="line">        <span class="keywordflow">if</span> (layer == NULL) {</div>
<div class="line">            <span class="keywordflow">continue</span>;</div>
<div class="line">        }</div>
<div class="line">        <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">        ret = !handle-&gt;can_write;</div>
<div class="line">        <a class="code hl_function" href="group__m__io__layer.html#ga4a296392e2a2a26c505575085e4ce177">M_io_layer_release</a>(layer);</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> ret;</div>
<div class="line">}</div>
<div class="ttc" id="agroup__m__buf_html_ga10fa5a66cbcb57830f0711050c363d70"><div class="ttname"><a href="group__m__buf.html#ga10fa5a66cbcb57830f0711050c363d70">M_buf_add_byte</a></div><div class="ttdeci">void M_buf_add_byte(M_buf_t *buf, unsigned char byte)</div></div>
<div class="ttc" id="agroup__m__buf_html_ga2eea65131f3d534ac2eca625808007e1"><div class="ttname"><a href="group__m__buf.html#ga2eea65131f3d534ac2eca625808007e1">M_buf_truncate</a></div><div class="ttdeci">void M_buf_truncate(M_buf_t *buf, size_t length)</div></div>
<div class="ttc" id="agroup__m__event_html_ga2809669810c4005a6750c4dfe21bf8a5"><div class="ttname"><a href="group__m__event.html#ga2809669810c4005a6750c4dfe21bf8a5">M_event_timer_start</a></div><div class="ttdeci">M_bool M_event_timer_start(M_event_timer_t *timer, M_uint64 interval_ms)</div></div>
<div class="ttc" id="agroup__m__event_html_ga45d217b7fc4c1310975855ccc2b894e9"><div class="ttname"><a href="group__m__event.html#ga45d217b7fc4c1310975855ccc2b894e9">M_event_timer_remove</a></div><div class="ttdeci">M_bool M_event_timer_remove(M_event_timer_t *timer)</div></div>
<div class="ttc" id="agroup__m__event_html_ga4b2788bfa150ff1bc6e2d4d2d7d05872"><div class="ttname"><a href="group__m__event.html#ga4b2788bfa150ff1bc6e2d4d2d7d05872">M_event_timer_add</a></div><div class="ttdeci">M_event_timer_t * M_event_timer_add(M_event_t *event, M_event_callback_t callback, void *cb_data)</div></div>
<div class="ttc" id="agroup__m__event_html_ga723018dc05c3b0ec6da531eb1788b86c"><div class="ttname"><a href="group__m__event.html#ga723018dc05c3b0ec6da531eb1788b86c">M_io_get_event</a></div><div class="ttdeci">M_event_t * M_io_get_event(M_io_t *io)</div></div>
<div class="ttc" id="agroup__m__event_html_ga747f0301bfcc6db3b51eaf07e2582350"><div class="ttname"><a href="group__m__event.html#ga747f0301bfcc6db3b51eaf07e2582350">M_event_t</a></div><div class="ttdeci">struct M_event M_event_t</div><div class="ttdef"><b>Definition:</b> m_event.h:210</div></div>
<div class="ttc" id="agroup__m__event_html_ga7cc2ffa4f595f828e84a0a42eb3bbabb"><div class="ttname"><a href="group__m__event.html#ga7cc2ffa4f595f828e84a0a42eb3bbabb">M_event_timer_stop</a></div><div class="ttdeci">M_bool M_event_timer_stop(M_event_timer_t *timer)</div></div>
<div class="ttc" id="agroup__m__event_html_gaf7cc7058deaf2fd06e4a4733d16c9b52"><div class="ttname"><a href="group__m__event.html#gaf7cc7058deaf2fd06e4a4733d16c9b52">M_event_timer_t</a></div><div class="ttdeci">struct M_event_timer M_event_timer_t</div><div class="ttdef"><b>Definition:</b> m_event.h:203</div></div>
<div class="ttc" id="agroup__m__fmt_html_gae54b252ea2bcf34b09ef1fa0f134ffa8"><div class="ttname"><a href="group__m__fmt.html#gae54b252ea2bcf34b09ef1fa0f134ffa8">M_printf</a></div><div class="ttdeci">ssize_t M_printf(const char *fmt,...)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga0c6d9cf0f642515db16a6e85d9285bbe"><div class="ttname"><a href="group__m__io__layer.html#ga0c6d9cf0f642515db16a6e85d9285bbe">M_io_layer_softevent_add</a></div><div class="ttdeci">void M_io_layer_softevent_add(M_io_layer_t *layer, M_bool sibling_only, M_event_type_t type, M_io_error_t err)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga4a296392e2a2a26c505575085e4ce177"><div class="ttname"><a href="group__m__io__layer.html#ga4a296392e2a2a26c505575085e4ce177">M_io_layer_release</a></div><div class="ttdeci">void M_io_layer_release(M_io_layer_t *layer)</div></div>
<div class="ttc" id="agroup__m__io__layer_html_ga8f5d7c26cf5f6d098cfc20c726dbdd04"><div class="ttname"><a href="group__m__io__layer.html#ga8f5d7c26cf5f6d098cfc20c726dbdd04">M_io_callbacks_reg_init</a></div><div class="ttdeci">M_bool M_io_callbacks_reg_init(M_io_callbacks_t *callbacks, M_bool(*cb_init)(M_io_layer_t *layer))</div></div>
<div class="ttc" id="agroup__m__io__layer_html_gac0385457484455f93fa23c2f6ab7c856"><div class="ttname"><a href="group__m__io__layer.html#gac0385457484455f93fa23c2f6ab7c856">M_io_layer_acquire</a></div><div class="ttdeci">M_io_layer_t * M_io_layer_acquire(M_io_t *io, size_t layer_id, const char *name)</div></div>
<div class="ttc" id="agroup__m__io_html_gab85f18fea241a1a9eb2f6ba966e5c892"><div class="ttname"><a href="group__m__io.html#gab85f18fea241a1a9eb2f6ba966e5c892">M_io_layer_count</a></div><div class="ttdeci">size_t M_io_layer_count(M_io_t *io)</div></div>
<div class="ttc" id="agroup__m__io_html_gga1ea9e3c1babf09b22f2b98899db790dba95386ec441cd9e0e5ca62a61881531ea"><div class="ttname"><a href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba95386ec441cd9e0e5ca62a61881531ea">M_IO_ERROR_TIMEDOUT</a></div><div class="ttdeci">@ M_IO_ERROR_TIMEDOUT</div><div class="ttdef"><b>Definition:</b> m_io.h:81</div></div>
<div class="ttc" id="agroup__m__mem_html_ga8a11dc1aa0bc31f10a1289043464f966"><div class="ttname"><a href="group__m__mem.html#ga8a11dc1aa0bc31f10a1289043464f966">M_mem_calc_lrc</a></div><div class="ttdeci">unsigned char M_mem_calc_lrc(const void *s, size_t s_len)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga1d3935a842a73de296cd9c1c32543609"><div class="ttname"><a href="group__m__parser.html#ga1d3935a842a73de296cd9c1c32543609">M_parser_len</a></div><div class="ttdeci">size_t M_parser_len(const M_parser_t *parser)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga391a35eb1787b282c73eb1021dc33c2b"><div class="ttname"><a href="group__m__parser.html#ga391a35eb1787b282c73eb1021dc33c2b">M_parser_append</a></div><div class="ttdeci">M_bool M_parser_append(M_parser_t *parser, const unsigned char *data, size_t len)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga3cd7b444d6f5058b149bc4c7262d5cb7"><div class="ttname"><a href="group__m__parser.html#ga3cd7b444d6f5058b149bc4c7262d5cb7">M_parser_destroy</a></div><div class="ttdeci">void M_parser_destroy(M_parser_t *parser)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga60164be64f8c962c795e5927642fc473"><div class="ttname"><a href="group__m__parser.html#ga60164be64f8c962c795e5927642fc473">M_parser_t</a></div><div class="ttdeci">struct M_parser M_parser_t</div><div class="ttdef"><b>Definition:</b> m_parser.h:52</div></div>
<div class="ttc" id="agroup__m__parser_html_ga64dd85cefe6dc965fde7532de8710957"><div class="ttname"><a href="group__m__parser.html#ga64dd85cefe6dc965fde7532de8710957">M_parser_consume_not_charset</a></div><div class="ttdeci">size_t M_parser_consume_not_charset(M_parser_t *parser, const unsigned char *charset, size_t charset_len)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga65cd501b432d08fb599afbd732ca58f4"><div class="ttname"><a href="group__m__parser.html#ga65cd501b432d08fb599afbd732ca58f4">M_parser_peek</a></div><div class="ttdeci">const unsigned char * M_parser_peek(const M_parser_t *parser)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga6993008e1f0881f84431d5813f33d127"><div class="ttname"><a href="group__m__parser.html#ga6993008e1f0881f84431d5813f33d127">M_PARSER_FRAME_ERROR</a></div><div class="ttdeci">M_PARSER_FRAME_ERROR</div><div class="ttdef"><b>Definition:</b> m_parser.h:95</div></div>
<div class="ttc" id="agroup__m__parser_html_ga92fee6f3045a04e33a5c075f09e72ba3"><div class="ttname"><a href="group__m__parser.html#ga92fee6f3045a04e33a5c075f09e72ba3">M_parser_read_stxetxlrc_message</a></div><div class="ttdeci">M_PARSER_FRAME_ERROR M_parser_read_stxetxlrc_message(M_parser_t *parser, M_parser_t **out, M_uint32 lrc_frame_chars)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga94d17dbc917bc704c9fea3030e1f8b45"><div class="ttname"><a href="group__m__parser.html#ga94d17dbc917bc704c9fea3030e1f8b45">M_parser_consume_charset</a></div><div class="ttdeci">size_t M_parser_consume_charset(M_parser_t *parser, const unsigned char *charset, size_t charset_len)</div></div>
<div class="ttc" id="agroup__m__parser_html_ga9713ad1ff5db4ec0cc5d2fa994ef9d23"><div class="ttname"><a href="group__m__parser.html#ga9713ad1ff5db4ec0cc5d2fa994ef9d23">M_parser_create</a></div><div class="ttdeci">M_parser_t * M_parser_create(M_uint32 flags)</div></div>
<div class="ttc" id="agroup__m__parser_html_gga3fbdc774c77f61b74f797598209b682caf93ba74fbec931a58ad1f78964572720"><div class="ttname"><a href="group__m__parser.html#gga3fbdc774c77f61b74f797598209b682caf93ba74fbec931a58ad1f78964572720">M_PARSER_FRAME_ETX</a></div><div class="ttdeci">@ M_PARSER_FRAME_ETX</div><div class="ttdef"><b>Definition:</b> m_parser.h:91</div></div>
<div class="ttc" id="agroup__m__parser_html_gga5f283601804b657a199f6574996ccf87a5879ad8c9fea3f4031268d7917b03933"><div class="ttname"><a href="group__m__parser.html#gga5f283601804b657a199f6574996ccf87a5879ad8c9fea3f4031268d7917b03933">M_PARSER_FLAG_NONE</a></div><div class="ttdeci">@ M_PARSER_FLAG_NONE</div><div class="ttdef"><b>Definition:</b> m_parser.h:60</div></div>
<div class="ttc" id="agroup__m__parser_html_gga6993008e1f0881f84431d5813f33d127a1163baeeb38554303ed45fed0edb15fc"><div class="ttname"><a href="group__m__parser.html#gga6993008e1f0881f84431d5813f33d127a1163baeeb38554303ed45fed0edb15fc">M_PARSER_FRAME_ERROR_SUCCESS</a></div><div class="ttdeci">@ M_PARSER_FRAME_ERROR_SUCCESS</div><div class="ttdef"><b>Definition:</b> m_parser.h:96</div></div>
<div class="ttc" id="agroup__m__parser_html_gga6993008e1f0881f84431d5813f33d127a701af53f85eb9dfd398ba8200b4d4059"><div class="ttname"><a href="group__m__parser.html#gga6993008e1f0881f84431d5813f33d127a701af53f85eb9dfd398ba8200b4d4059">M_PARSER_FRAME_ERROR_LRC_CALC_FAILED</a></div><div class="ttdeci">@ M_PARSER_FRAME_ERROR_LRC_CALC_FAILED</div><div class="ttdef"><b>Definition:</b> m_parser.h:101</div></div>
</div><!-- fragment --><h3><a class="anchor" id="autotoc_md74"></a>
BLE Helper</h3>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;mstdlib/io/m_io_layer.h&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *LAYER_NAME         = <span class="stringliteral">&quot;BLE_SERVICE_HELPER&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *BLE_SERVICE        = <span class="stringliteral">&quot;68950001-FBA1-BB3D-A043-647EF78ACD44&quot;</span>;</div>
<div class="line"><span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">char</span> *BLE_CHARACTERISTIC = <span class="stringliteral">&quot;68951001-FBA1-BB3D-A043-647EF78ACD44&quot;</span>;</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">struct </span>M_io_handle {</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *write_meta;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>     *read_buf;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a>     *write_buf;</div>
<div class="line">    <span class="keywordtype">char</span>         err[256];</div>
<div class="line">    M_bool       connected;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="comment">// Writes as much data as possible from the given buffer to the layer below this one.</span></div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_to_next_layer(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *buf, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>       *io;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>  err;</div>
<div class="line">    <span class="keywordtype">size_t</span>        layer_idx;</div>
<div class="line">    <span class="keywordtype">size_t</span>        write_len;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (layer == NULL || <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    io        = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    layer_idx = <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (io == NULL || layer_idx == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    err = <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">    <span class="keywordflow">do</span> {</div>
<div class="line">        write_len = <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf);</div>
<div class="line">        err       = <a class="code hl_function" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a>(io, layer_idx - 1, (<span class="keyword">const</span> M_uint8 *)<a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(buf), &amp;write_len, meta);</div>
<div class="line">        <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">            <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(buf, write_len);</div>
<div class="line">        }</div>
<div class="line">    } <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a> &amp;&amp; <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(buf) &gt; 0);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_pair_check_data(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__buf.html#ga6c543ecf0004fc310faa23c6ed8b267f">M_buf_t</a> *write_buf, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *write_meta)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Simple command used as a dummy write to initiate pairing if needed. We just want to send something.</span></div>
<div class="line">    <span class="comment">// But this should be a real, simple, command for the device.</span></div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a>(write_buf, <span class="stringliteral">&quot;123\r\n&quot;</span>);</div>
<div class="line">    <span class="keywordflow">return</span> write_to_next_layer(layer, write_buf, write_meta);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> register_notifications(<a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io, <a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keyword">const</span> <span class="keywordtype">char</span> *service_uuid, <span class="keyword">const</span> <span class="keywordtype">char</span> *char_uuid)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a>  *meta;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>  err;</div>
<div class="line"> </div>
<div class="line">    meta = <a class="code hl_function" href="group__m__io.html#ga9563cecb76dc6900b84d04d8532e613f">M_io_meta_create</a>();</div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#gab02e3ad2ccd243ce6e994ef4ab6fc50d">M_io_ble_meta_set_service</a>(io, meta, service_uuid);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#gaf9fa5c479c7409045d6f1c3122e95056">M_io_ble_meta_set_characteristic</a>(io, meta, char_uuid);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#gae8a0454f1435a66dd00d06f4daf9a7b6">M_io_ble_meta_set_notify</a>(io, meta, M_TRUE);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#ga1884f2b80b9eb2c0df3b9ab44fbf6b00">M_io_ble_meta_set_write_type</a>(io, meta, <a class="code hl_enumvalue" href="group__m__io__ble.html#gga4b55a7fbad9e0c4eaf609d7b0aeb93f7a19f3e75c0718ad48d801e6eb16059d5f">M_IO_BLE_WTYPE_REQNOTIFY</a>);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Write the metadata to the device to register we want to receive notification read events.</span></div>
<div class="line">    err = <a class="code hl_function" href="group__m__io__layer.html#ga2bd63bc8d12ca0735492aebcfc9cb759">M_io_layer_write</a>(io, <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer) - 1, NULL, NULL, meta);</div>
<div class="line">    <a class="code hl_function" href="group__m__io.html#ga7586ea2e66889f608975ce17f96e6298">M_io_meta_destroy</a>(meta);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool processevent_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="code hl_typedef" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle  = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a>        *io      = <a class="code hl_function" href="group__m__io__layer.html#ga3b70072aa40efdce81eb6efcde9bfc59">M_io_layer_get_io</a>(layer);</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a>   *meta;</div>
<div class="line">    M_bool         consume = M_FALSE; <span class="comment">// Default to passing onto the next layer.</span></div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>   err;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || io == NULL)</div>
<div class="line">        <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">switch</span> (*type) {</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2">M_EVENT_TYPE_CONNECTED</a>:</div>
<div class="line">            <span class="comment">// If the device uses secure bonded/paired connections and a device is not paired, pairing takes place</span></div>
<div class="line">             <span class="comment">// when a secure characteristic is first written. At which point the device will show a PIN</span></div>
<div class="line">            <span class="comment">// and system (iOS, macOS...) will show a prompt to enter the PIN. We&#39;ll delay sending the </span></div>
<div class="line">            <span class="comment">// connected event until we get a response to a basic message that we use internally</span></div>
<div class="line">            <span class="comment">// to verify or initiate the pairing.</span></div>
<div class="line">            <span class="comment">//</span></div>
<div class="line">            <span class="comment">// We need to do this before trying to register for notifications. If</span></div>
<div class="line">            <span class="comment">// we&#39;re already paired then there is no problem. However, if we aren&#39;t</span></div>
<div class="line">            <span class="comment">// paired and need to go through pairing, attempting to register a notification</span></div>
<div class="line">            <span class="comment">// before writing a message will cause the device to disconnect.</span></div>
<div class="line">            err = write_pair_check_data(layer, handle-&gt;write_buf, handle-&gt;write_meta);</div>
<div class="line">            <span class="keywordflow">if</span> (err != <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">                <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error writing initial pairing message: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">                *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line">            consume = M_TRUE;</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a1713e94c1e0750f168d255f580fd4ad9">M_EVENT_TYPE_WRITE</a>:</div>
<div class="line">            <span class="comment">// Write event if we&#39;re not connected means this is a confirmation event that the data we</span></div>
<div class="line">             <span class="comment">// wrote was processed. If we&#39;re paired we&#39;ll get this right away. If we&#39;re not paired</span></div>
<div class="line">            <span class="comment">// we&#39;ll get this when pairing is successful. Otherwise, we&#39;d get an error event.</span></div>
<div class="line">            <span class="keywordflow">if</span> (!handle-&gt;connected) {</div>
<div class="line">                <span class="comment">// We&#39;re paired so we can register for our read events.</span></div>
<div class="line">                consume = M_TRUE;</div>
<div class="line">                register_notifications(io, layer, BLE_SERVICE, BLE_CHARACTERISTIC);</div>
<div class="line">                <span class="keywordflow">break</span>;</div>
<div class="line">            }</div>
<div class="line"> </div>
<div class="line">            <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) != 0) {</div>
<div class="line">                err = write_to_next_layer(layer, handle-&gt;write_buf, handle-&gt;write_meta);</div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">                    <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error writing data: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">                    *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) != 0) {</div>
<div class="line">                    <span class="comment">// Don&#39;t inform higher levels we can write if we have more data pending.</span></div>
<div class="line">                    consume = M_TRUE;</div>
<div class="line">                }</div>
<div class="line">            }</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a8d2cf32ca08773c695e988635ebfd426">M_EVENT_TYPE_READ</a>:</div>
<div class="line">            <span class="comment">// We&#39;re getting data from the device. Let&#39;s pull out the data and check if we want it or not.</span></div>
<div class="line">            meta = <a class="code hl_function" href="group__m__io.html#ga9563cecb76dc6900b84d04d8532e613f">M_io_meta_create</a>();</div>
<div class="line">            <span class="keywordflow">do</span> {</div>
<div class="line">                M_uint8 buf[256] = { 0 };</div>
<div class="line">                <span class="keywordtype">size_t</span>  buf_len  = <span class="keyword">sizeof</span>(buf);</div>
<div class="line"> </div>
<div class="line">                err = <a class="code hl_function" href="group__m__io__layer.html#ga5458358c5cd46f140520b27d0a17db1c">M_io_layer_read</a>(io, <a class="code hl_function" href="group__m__io__layer.html#ga4ed8f7126e4355ebc378bc2aefe710a5">M_io_layer_get_index</a>(layer) - 1, buf, &amp;buf_len, meta);</div>
<div class="line">                <span class="comment">// We should get one notification response to the single notification we requested.</span></div>
<div class="line">                 <span class="comment">// If we aren&#39;t connected and we get it, then we want to tell those above us we&#39;re</span></div>
<div class="line">                <span class="comment">// connected now that we&#39;ve finished setup. Otherwise, if we get an unexpected notification</span></div>
<div class="line">                <span class="comment">// response, eat it because there is no data for anyone to read.</span></div>
<div class="line">                <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__ble.html#ga420beb176106ca6905a3156689d8b5d2">M_io_ble_meta_get_read_type</a>(io, meta) == <a class="code hl_enumvalue" href="group__m__io__ble.html#ggafca547d077ba95755aca3592db88a6d9a3d8826ef69e30f206b864deb2d0ffaf7">M_IO_BLE_RTYPE_NOTIFY</a>) {</div>
<div class="line">                    <span class="keywordflow">if</span> (handle-&gt;connected) {</div>
<div class="line">                        consume = M_TRUE;</div>
<div class="line">                    } <span class="keywordflow">else</span> {</div>
<div class="line">                        handle-&gt;connected  = M_TRUE;</div>
<div class="line">                        *type              = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7ab0fc60e031020cb3f36b70c4932d67f2">M_EVENT_TYPE_CONNECTED</a>;</div>
<div class="line">                        <span class="keywordflow">break</span>;</div>
<div class="line">                    }</div>
<div class="line">                }</div>
<div class="line"> </div>
<div class="line">                <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>) {</div>
<div class="line">                    <span class="comment">// Save the data into the handler&#39;s buffer so we</span></div>
<div class="line">                    <span class="comment">// can pass it up to the layer above in the read callback.</span></div>
<div class="line">                    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;read_buf, buf, buf_len);</div>
<div class="line">                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__io__layer.html#ga15da485fce90d4ec273554a35ec50bfa">M_io_error_is_critical</a>(err)) {</div>
<div class="line">                    <a class="code hl_function" href="group__m__fmt.html#ga148cb889ab2737a09ebf313e7a3d454b">M_snprintf</a>(handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err), <span class="stringliteral">&quot;Error reading data: %s&quot;</span>, <a class="code hl_function" href="group__m__io.html#gab4e93021ae39b99bbe311ed7c45676d3">M_io_error_string</a>(err));</div>
<div class="line">                    *type = <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>;</div>
<div class="line">                    <span class="keywordflow">break</span>;</div>
<div class="line">                }</div>
<div class="line">            } <span class="keywordflow">while</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>);</div>
<div class="line">            <a class="code hl_function" href="group__m__io.html#ga7586ea2e66889f608975ce17f96e6298">M_io_meta_destroy</a>(meta);</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7adce269f93799cdca69ac20235895d0ac">M_EVENT_TYPE_ERROR</a>:</div>
<div class="line">            <a class="code hl_function" href="group__m__io.html#ga3e1f56ec1e586649c1b26eb7c72238de">M_io_get_error_string</a>(io, handle-&gt;err, <span class="keyword">sizeof</span>(handle-&gt;err));</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a571c000a93b3c198364a32e5e145f2d0">M_EVENT_TYPE_ACCEPT</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a6cead05362ca89b2cc7353bf6b4c2c6e">M_EVENT_TYPE_DISCONNECTED</a>:</div>
<div class="line">        <span class="keywordflow">case</span> <a class="code hl_enumvalue" href="group__m__event.html#gga5d54358d8088f050bcdb141c6c0b21e7a89a67d4e5f2bdcadc1ffa3ba0473a6cf">M_EVENT_TYPE_OTHER</a>:</div>
<div class="line">            <span class="keywordflow">break</span>;</div>
<div class="line">    }</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// M_TRUE to discard this event, or M_FALSE to pass it on to the next layer.</span></div>
<div class="line">    <span class="keywordflow">return</span> consume;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> read_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *buf_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    (void)meta;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || buf_len == NULL || *buf_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Check if we have any more data to pass on or not.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;read_buf) == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Pass on as much data as possible.</span></div>
<div class="line">    *buf_len = <a class="code hl_define" href="group__m__math.html#ga6237309498df9996986cce08c6550824">M_MIN</a>(*buf_len, <a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;read_buf));</div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#ga3ce920591c513671ee62bdb57e846b72">M_mem_copy</a>(buf, <a class="code hl_function" href="group__m__buf.html#ga959ff4d1dd23186caf65086ebcdeaaaa">M_buf_peek</a>(handle-&gt;read_buf), *buf_len);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga4fc41c9b5746d69a40e8f9aaef53a105">M_buf_drop</a>(handle-&gt;read_buf, *buf_len);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> write_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> *buf, <span class="keywordtype">size_t</span> *buf_len, <a class="code hl_typedef" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>   err;</div>
<div class="line"> </div>
<div class="line">    (void)meta;</div>
<div class="line"> </div>
<div class="line">    handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (handle == NULL || buf == NULL || buf_len == NULL || *buf_len == 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dbad9e65db26d85903e8f8a473adea33db3">M_IO_ERROR_INVALID</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (!handle-&gt;connected)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Don&#39;t allow buffering data if we have data waiting to write.</span></div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__buf.html#gaaff39362df33795d6c188ca3482a12cd">M_buf_len</a>(handle-&gt;write_buf) &gt; 0)</div>
<div class="line">        <span class="keywordflow">return</span> <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#ga288de250b37d2811d57b8ffe20e89bbc">M_buf_add_bytes</a>(handle-&gt;write_buf, buf, *buf_len);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Try to write as much of the message as we can right now.</span></div>
<div class="line">    err = write_to_next_layer(layer, handle-&gt;write_buf, handle-&gt;write_meta);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Treat would block as success because we&#39;ve buffered the data and it will</span></div>
<div class="line">     <span class="comment">// be written when possible.</span></div>
<div class="line">    <span class="keywordflow">if</span> (err == <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2ace85a86b9ab6805d5838754b4c111c">M_IO_ERROR_WOULDBLOCK</a>)</div>
<div class="line">        err = <a class="code hl_enumvalue" href="group__m__io.html#gga1ea9e3c1babf09b22f2b98899db790dba2778f41c2ec2dc7c612144ea5a591c30">M_IO_ERROR_SUCCESS</a>;</div>
<div class="line">    <span class="keywordflow">return</span> err;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> unregister_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// Dummy callback - only here because the docs for M_io_callbacks_t requires it to be present.</span></div>
<div class="line"><span class="keyword">static</span> M_bool reset_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    (void)layer;</div>
<div class="line">    <span class="comment">// No-op</span></div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> <span class="keywordtype">void</span> destroy_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io.html#ga7586ea2e66889f608975ce17f96e6298">M_io_meta_destroy</a>(handle-&gt;write_meta);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;read_buf);</div>
<div class="line">    <a class="code hl_function" href="group__m__buf.html#gad51baebd5e46ee8231e78b926ccb198e">M_buf_cancel</a>(handle-&gt;write_buf);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__mem.html#gac4b3c1d73d6efe2542f5e729b58a271d">M_free</a>(handle);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keyword">static</span> M_bool error_cb(<a class="code hl_typedef" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <span class="keywordtype">char</span> *error, <span class="keywordtype">size_t</span> err_len)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *handle = <a class="code hl_function" href="group__m__io__layer.html#gac836dc863f54af46a2123fe0cd97bf73">M_io_layer_get_handle</a>(layer);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (<a class="code hl_function" href="group__m__str__check.html#ga530dc6e198ebf9e5c30bc7a28ea4567d">M_str_isempty</a>(handle-&gt;err))</div>
<div class="line">        <span class="keywordflow">return</span> M_FALSE;</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__str__mutate.html#ga050277b36c7f2ea5ff7aa68a0933c6c0">M_str_cpy</a>(error, err_len, handle-&gt;err);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">return</span> M_TRUE;</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="comment">// - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - - -</span></div>
<div class="line"><span class="comment">// --- MAIN ENTRY ---</span></div>
<div class="line"><span class="comment">//</span></div>
<div class="line"><span class="keywordtype">void</span> ble_helper_io_layer(<a class="code hl_typedef" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *io)</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a>    *handle;</div>
<div class="line">    <a class="code hl_typedef" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *callbacks;</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">if</span> (io == NULL)</div>
<div class="line">        <span class="keywordflow">return</span>;</div>
<div class="line"> </div>
<div class="line">    handle             = <a class="code hl_function" href="group__m__mem.html#ga35c94b89c8d56bc0486c91773a0e0b4c">M_malloc_zero</a>(<span class="keyword">sizeof</span>(*handle));</div>
<div class="line">    handle-&gt;write_meta = <a class="code hl_function" href="group__m__io.html#ga9563cecb76dc6900b84d04d8532e613f">M_io_meta_create</a>();</div>
<div class="line">    handle-&gt;read_buf   = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line">    handle-&gt;write_buf  = <a class="code hl_function" href="group__m__buf.html#gab7bc47e38392716005270b68699c22eb">M_buf_create</a>();</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#gab02e3ad2ccd243ce6e994ef4ab6fc50d">M_io_ble_meta_set_service</a>(io, handle-&gt;write_meta, BLE_SERVICE);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#gaf9fa5c479c7409045d6f1c3122e95056">M_io_ble_meta_set_characteristic</a>(io, handle-&gt;write_meta, BLE_CHARACTERISTIC);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__ble.html#ga1884f2b80b9eb2c0df3b9ab44fbf6b00">M_io_ble_meta_set_write_type</a>(io, handle-&gt;write_meta, <a class="code hl_enumvalue" href="group__m__io__ble.html#gga4b55a7fbad9e0c4eaf609d7b0aeb93f7accf6129e087d546f30dfb69ff5d1b43b">M_IO_BLE_WTYPE_WRITE</a>);</div>
<div class="line"> </div>
<div class="line">    callbacks = <a class="code hl_function" href="group__m__io__layer.html#gaabe9a59e44560a8c52102c637ec27627">M_io_callbacks_create</a>();</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0c3837dbffed3aac4ab6ffa5d3bd4590">M_io_callbacks_reg_processevent</a>(callbacks, processevent_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga0de59d7872b9a47d2230ff7c6ec0c27c">M_io_callbacks_reg_read</a>(callbacks, read_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gade360ffe79e68306fe3c8911a9ed3358">M_io_callbacks_reg_write</a>(callbacks, write_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gabd2d14eb725d528ef98bb8b967ae1e40">M_io_callbacks_reg_unregister</a>(callbacks, unregister_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga9d663c831069a59ca067bf99f6a4bced">M_io_callbacks_reg_reset</a>(callbacks, reset_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga89d597baaffaf2102983258b8c73fe52">M_io_callbacks_reg_destroy</a>(callbacks, destroy_cb);</div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga05ac9b73c65d904407734f6b70da7d43">M_io_callbacks_reg_errormsg</a>(callbacks, error_cb);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#gaa122109d6ad148d8daae65c0322c4fae">M_io_layer_add</a>(io, LAYER_NAME, handle, callbacks);</div>
<div class="line"> </div>
<div class="line">    <a class="code hl_function" href="group__m__io__layer.html#ga6458e6066300fa9f3cb4dd62e40d200d">M_io_callbacks_destroy</a>(callbacks);</div>
<div class="line">}</div>
<div class="ttc" id="agroup__m__buf_html_gad226a7199f864ff6a630dc7f16508c30"><div class="ttname"><a href="group__m__buf.html#gad226a7199f864ff6a630dc7f16508c30">M_buf_add_str</a></div><div class="ttdeci">void M_buf_add_str(M_buf_t *buf, const char *str)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_ga1884f2b80b9eb2c0df3b9ab44fbf6b00"><div class="ttname"><a href="group__m__io__ble.html#ga1884f2b80b9eb2c0df3b9ab44fbf6b00">M_io_ble_meta_set_write_type</a></div><div class="ttdeci">void M_io_ble_meta_set_write_type(M_io_t *io, M_io_meta_t *meta, M_io_ble_wtype_t type)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_ga420beb176106ca6905a3156689d8b5d2"><div class="ttname"><a href="group__m__io__ble.html#ga420beb176106ca6905a3156689d8b5d2">M_io_ble_meta_get_read_type</a></div><div class="ttdeci">M_io_ble_rtype_t M_io_ble_meta_get_read_type(M_io_t *io, M_io_meta_t *meta)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_gab02e3ad2ccd243ce6e994ef4ab6fc50d"><div class="ttname"><a href="group__m__io__ble.html#gab02e3ad2ccd243ce6e994ef4ab6fc50d">M_io_ble_meta_set_service</a></div><div class="ttdeci">void M_io_ble_meta_set_service(M_io_t *io, M_io_meta_t *meta, const char *service_uuid)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_gae8a0454f1435a66dd00d06f4daf9a7b6"><div class="ttname"><a href="group__m__io__ble.html#gae8a0454f1435a66dd00d06f4daf9a7b6">M_io_ble_meta_set_notify</a></div><div class="ttdeci">void M_io_ble_meta_set_notify(M_io_t *io, M_io_meta_t *meta, M_bool enable)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_gaf9fa5c479c7409045d6f1c3122e95056"><div class="ttname"><a href="group__m__io__ble.html#gaf9fa5c479c7409045d6f1c3122e95056">M_io_ble_meta_set_characteristic</a></div><div class="ttdeci">void M_io_ble_meta_set_characteristic(M_io_t *io, M_io_meta_t *meta, const char *characteristic_uuid)</div></div>
<div class="ttc" id="agroup__m__io__ble_html_gga4b55a7fbad9e0c4eaf609d7b0aeb93f7a19f3e75c0718ad48d801e6eb16059d5f"><div class="ttname"><a href="group__m__io__ble.html#gga4b55a7fbad9e0c4eaf609d7b0aeb93f7a19f3e75c0718ad48d801e6eb16059d5f">M_IO_BLE_WTYPE_REQNOTIFY</a></div><div class="ttdeci">@ M_IO_BLE_WTYPE_REQNOTIFY</div><div class="ttdef"><b>Definition:</b> m_io_ble.h:1143</div></div>
<div class="ttc" id="agroup__m__io__ble_html_gga4b55a7fbad9e0c4eaf609d7b0aeb93f7accf6129e087d546f30dfb69ff5d1b43b"><div class="ttname"><a href="group__m__io__ble.html#gga4b55a7fbad9e0c4eaf609d7b0aeb93f7accf6129e087d546f30dfb69ff5d1b43b">M_IO_BLE_WTYPE_WRITE</a></div><div class="ttdeci">@ M_IO_BLE_WTYPE_WRITE</div><div class="ttdef"><b>Definition:</b> m_io_ble.h:1136</div></div>
<div class="ttc" id="agroup__m__io__ble_html_ggafca547d077ba95755aca3592db88a6d9a3d8826ef69e30f206b864deb2d0ffaf7"><div class="ttname"><a href="group__m__io__ble.html#ggafca547d077ba95755aca3592db88a6d9a3d8826ef69e30f206b864deb2d0ffaf7">M_IO_BLE_RTYPE_NOTIFY</a></div><div class="ttdeci">@ M_IO_BLE_RTYPE_NOTIFY</div><div class="ttdef"><b>Definition:</b> m_io_ble.h:1154</div></div>
<div class="ttc" id="agroup__m__io_html_ga7586ea2e66889f608975ce17f96e6298"><div class="ttname"><a href="group__m__io.html#ga7586ea2e66889f608975ce17f96e6298">M_io_meta_destroy</a></div><div class="ttdeci">void M_io_meta_destroy(M_io_meta_t *meta)</div></div>
<div class="ttc" id="agroup__m__io_html_ga9563cecb76dc6900b84d04d8532e613f"><div class="ttname"><a href="group__m__io.html#ga9563cecb76dc6900b84d04d8532e613f">M_io_meta_create</a></div><div class="ttdeci">M_io_meta_t * M_io_meta_create(void)</div></div>
</div><!-- fragment --> <h2 class="groupheader">Macro Definition Documentation</h2>
<a id="gad64f30489df3afe6a46519f135f6cc9c" name="gad64f30489df3afe6a46519f135f6cc9c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gad64f30489df3afe6a46519f135f6cc9c">&#9670;&nbsp;</a></span>M_EVENT_HANDLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_EVENT_HANDLE&#160;&#160;&#160;int</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="gaad38ecd42f1c7a8411b4e8518a045285" name="gaad38ecd42f1c7a8411b4e8518a045285"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaad38ecd42f1c7a8411b4e8518a045285">&#9670;&nbsp;</a></span>M_EVENT_INVALID_HANDLE</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_EVENT_INVALID_HANDLE&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga1ef77f83c27dd02daf92051706da96e3" name="ga1ef77f83c27dd02daf92051706da96e3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga1ef77f83c27dd02daf92051706da96e3">&#9670;&nbsp;</a></span>M_EVENT_SOCKET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_EVENT_SOCKET&#160;&#160;&#160;int</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="gaca339a57429a3eaabe127c3a3da8f8df" name="gaca339a57429a3eaabe127c3a3da8f8df"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaca339a57429a3eaabe127c3a3da8f8df">&#9670;&nbsp;</a></span>M_EVENT_INVALID_SOCKET</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_EVENT_INVALID_SOCKET&#160;&#160;&#160;-1</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga26df4f9396da636810f70301148989c6" name="ga26df4f9396da636810f70301148989c6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga26df4f9396da636810f70301148989c6">&#9670;&nbsp;</a></span>M_IO_LAYERS_MAX</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define M_IO_LAYERS_MAX&#160;&#160;&#160;16</td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Maximum number of layers for an I/O object. One reserved for the user layer </p>

</div>
</div>
<h2 class="groupheader">Typedef Documentation</h2>
<a id="ga2c76e456b8335433f53eadfac91e4533" name="ga2c76e456b8335433f53eadfac91e4533"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2c76e456b8335433f53eadfac91e4533">&#9670;&nbsp;</a></span>M_io_layer_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct M_io_layer <a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga4e34a19e8722fc40cf6074c0fd9131f3" name="ga4e34a19e8722fc40cf6074c0fd9131f3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4e34a19e8722fc40cf6074c0fd9131f3">&#9670;&nbsp;</a></span>M_io_handle_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct M_io_handle <a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="gaa3531457bf1cd87643022318658f60c3" name="gaa3531457bf1cd87643022318658f60c3"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa3531457bf1cd87643022318658f60c3">&#9670;&nbsp;</a></span>M_io_callbacks_t</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">typedef struct M_io_callbacks <a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<h2 class="groupheader">Function Documentation</h2>
<a id="gac0385457484455f93fa23c2f6ab7c856" name="gac0385457484455f93fa23c2f6ab7c856"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac0385457484455f93fa23c2f6ab7c856">&#9670;&nbsp;</a></span>M_io_layer_acquire()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> * M_io_layer_acquire </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>layer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>name</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Find the appropriate layer and grab the handle and lock it.</p>
<dl class="section warning"><dt>Warning</dt><dd>Locking the layer locks the entire event loop. Only very short operations that will not block should be performed while a layer lock is being held.</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramdir">[in]</td><td class="paramname">io</td><td>Pointer to io object </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">layer_id</td><td>id of layer to lock, or M_IO_LAYER_FIND_FIRST_ID to search for layer. </td></tr>
    <tr><td class="paramdir">[in]</td><td class="paramname">name</td><td>Name of layer to lock. This can be used as a sanity check to ensure the layer id really matches the layer type. Use NULL if name matching is not required. If M_IO_LAYER_FIND_FIRST_ID is used for the layer_id, this parameter cannot be NULL.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>locked io layer, or NULL on failure</dd></dl>
<dl class="section see"><dt>See also</dt><dd><a class="el" href="group__m__io__layer.html#ga4a296392e2a2a26c505575085e4ce177">M_io_layer_release</a> </dd></dl>

</div>
</div>
<a id="ga4a296392e2a2a26c505575085e4ce177" name="ga4a296392e2a2a26c505575085e4ce177"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4a296392e2a2a26c505575085e4ce177">&#9670;&nbsp;</a></span>M_io_layer_release()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_layer_release </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Release the lock on the layer </p>

</div>
</div>
<a id="ga2d0af1d4aa694c0a9b353c6a775e6467" name="ga2d0af1d4aa694c0a9b353c6a775e6467"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2d0af1d4aa694c0a9b353c6a775e6467">&#9670;&nbsp;</a></span>M_io_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> * M_io_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga7657fac3681f734efc697e3116ee8077">M_io_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Initialize a new io object of given type </p>

</div>
</div>
<a id="gac666dc833a02d04d943fb0415908d914" name="gac666dc833a02d04d943fb0415908d914"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac666dc833a02d04d943fb0415908d914">&#9670;&nbsp;</a></span>M_io_get_type()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io.html#ga7657fac3681f734efc697e3116ee8077">M_io_type_t</a> M_io_get_type </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Get the type of the io object </p>

</div>
</div>
<a id="gaabe9a59e44560a8c52102c637ec27627" name="gaabe9a59e44560a8c52102c637ec27627"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaabe9a59e44560a8c52102c637ec27627">&#9670;&nbsp;</a></span>M_io_callbacks_create()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> * M_io_callbacks_create </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Create M_io_callbacks_t object that can be passed to M_io_layer_add </p>

</div>
</div>
<a id="ga8f5d7c26cf5f6d098cfc20c726dbdd04" name="ga8f5d7c26cf5f6d098cfc20c726dbdd04"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga8f5d7c26cf5f6d098cfc20c726dbdd04">&#9670;&nbsp;</a></span>M_io_callbacks_reg_init()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_init</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to initialize/begin. Is called when the io object is attached to an event. Mandatory. </p>

</div>
</div>
<a id="gabd56f7000fb05fbdbfa7effe4c8acf4b" name="gabd56f7000fb05fbdbfa7effe4c8acf4b"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabd56f7000fb05fbdbfa7effe4c8acf4b">&#9670;&nbsp;</a></span>M_io_callbacks_reg_accept()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_accept </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*)(<a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *new_conn, <a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *orig_layer)&#160;</td>
          <td class="paramname"><em>cb_accept</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to accept a new connection. Conditional. </p>

</div>
</div>
<a id="ga0de59d7872b9a47d2230ff7c6ec0c27c" name="ga0de59d7872b9a47d2230ff7c6ec0c27c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0de59d7872b9a47d2230ff7c6ec0c27c">&#9670;&nbsp;</a></span>M_io_callbacks_reg_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, unsigned char *buf, size_t *read_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)&#160;</td>
          <td class="paramname"><em>cb_read</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to read from the connection. Optional if not base layer, required if base layer </p>

</div>
</div>
<a id="gade360ffe79e68306fe3c8911a9ed3358" name="gade360ffe79e68306fe3c8911a9ed3358"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gade360ffe79e68306fe3c8911a9ed3358">&#9670;&nbsp;</a></span>M_io_callbacks_reg_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, const unsigned char *buf, size_t *write_len, <a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *meta)&#160;</td>
          <td class="paramname"><em>cb_write</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to write to the connection. Optional if not base layer, required if base layer </p>

</div>
</div>
<a id="ga0c3837dbffed3aac4ab6ffa5d3bd4590" name="ga0c3837dbffed3aac4ab6ffa5d3bd4590"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0c3837dbffed3aac4ab6ffa5d3bd4590">&#9670;&nbsp;</a></span>M_io_callbacks_reg_processevent()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_processevent </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, <a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a> *type)&#160;</td>
          <td class="paramname"><em>cb_process_event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to process events. Optional. If returns M_TRUE event is consumed and not propagated to the next layer. </p>

</div>
</div>
<a id="gabd2d14eb725d528ef98bb8b967ae1e40" name="gabd2d14eb725d528ef98bb8b967ae1e40"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gabd2d14eb725d528ef98bb8b967ae1e40">&#9670;&nbsp;</a></span>M_io_callbacks_reg_unregister()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_unregister </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_unregister</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback that is called when io object is removed from event object. Mandatory </p>

</div>
</div>
<a id="ga4d4d62d87648fc5d7a76b9e4db81e762" name="ga4d4d62d87648fc5d7a76b9e4db81e762"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4d4d62d87648fc5d7a76b9e4db81e762">&#9670;&nbsp;</a></span>M_io_callbacks_reg_disconnect()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_disconnect </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_disconnect</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to start a graceful disconnect sequence. Optional. </p>

</div>
</div>
<a id="ga9d663c831069a59ca067bf99f6a4bced" name="ga9d663c831069a59ca067bf99f6a4bced"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga9d663c831069a59ca067bf99f6a4bced">&#9670;&nbsp;</a></span>M_io_callbacks_reg_reset()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_reset </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_reset</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to reset any state (M_io_handle_t *). Optional.</p>
<p >Will reset the state of the layer for re-connection. </p>

</div>
</div>
<a id="ga89d597baaffaf2102983258b8c73fe52" name="ga89d597baaffaf2102983258b8c73fe52"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga89d597baaffaf2102983258b8c73fe52">&#9670;&nbsp;</a></span>M_io_callbacks_reg_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">void(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_destroy</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to destroy any state (M_io_handle_t *). Mandatory.</p>
<p >The event loop has already been disassociated from the layer when this callback is called. The layer will not be locked and M_io_layer_acquire will not lock the layer as the layer cannot be locked. </p>

</div>
</div>
<a id="ga50e5fa28fe89cf44a9565bc929b3b5af" name="ga50e5fa28fe89cf44a9565bc929b3b5af"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga50e5fa28fe89cf44a9565bc929b3b5af">&#9670;&nbsp;</a></span>M_io_callbacks_reg_state()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_state </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#gad891a3fd8aebdaed3431b834c1ecf345">M_io_state_t</a>(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer)&#160;</td>
          <td class="paramname"><em>cb_state</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to get the layer state. Optional if not base layer, required if base layer. </p>

</div>
</div>
<a id="ga05ac9b73c65d904407734f6b70da7d43" name="ga05ac9b73c65d904407734f6b70da7d43"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga05ac9b73c65d904407734f6b70da7d43">&#9670;&nbsp;</a></span>M_io_callbacks_reg_errormsg()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_callbacks_reg_errormsg </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool(*)(<a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *layer, char *error, size_t err_len)&#160;</td>
          <td class="paramname"><em>cb_errormsg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Register callback to get the error message, will be called if cb_state returns M_IO_STATE_ERROR. If registered, cb_state must also be registered </p>

</div>
</div>
<a id="ga6458e6066300fa9f3cb4dd62e40d200d" name="ga6458e6066300fa9f3cb4dd62e40d200d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga6458e6066300fa9f3cb4dd62e40d200d">&#9670;&nbsp;</a></span>M_io_callbacks_destroy()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_callbacks_destroy </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Destroy M_io_callbacks_t object </p>

</div>
</div>
<a id="gaa122109d6ad148d8daae65c0322c4fae" name="gaa122109d6ad148d8daae65c0322c4fae"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gaa122109d6ad148d8daae65c0322c4fae">&#9670;&nbsp;</a></span>M_io_layer_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> * M_io_layer_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&#160;</td>
          <td class="paramname"><em>layer_name</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> *&#160;</td>
          <td class="paramname"><em>handle</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const <a class="el" href="group__m__io__layer.html#gaa3531457bf1cd87643022318658f60c3">M_io_callbacks_t</a> *&#160;</td>
          <td class="paramname"><em>callbacks</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Add a layer to an io object </p>

</div>
</div>
<a id="ga3b70072aa40efdce81eb6efcde9bfc59" name="ga3b70072aa40efdce81eb6efcde9bfc59"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga3b70072aa40efdce81eb6efcde9bfc59">&#9670;&nbsp;</a></span>M_io_layer_get_io()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> * M_io_layer_get_io </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Given a layer object, retrieve the M_io_t reference </p>

</div>
</div>
<a id="ga769f5a1f4323214bd8b6973707d447b7" name="ga769f5a1f4323214bd8b6973707d447b7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga769f5a1f4323214bd8b6973707d447b7">&#9670;&nbsp;</a></span>M_io_layer_get_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">const char * M_io_layer_get_name </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Given a layer object, retrieve the name of the layer </p>

</div>
</div>
<a id="gac836dc863f54af46a2123fe0cd97bf73" name="gac836dc863f54af46a2123fe0cd97bf73"></a>
<h2 class="memtitle"><span class="permalink"><a href="#gac836dc863f54af46a2123fe0cd97bf73">&#9670;&nbsp;</a></span>M_io_layer_get_handle()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io__layer.html#ga4e34a19e8722fc40cf6074c0fd9131f3">M_io_handle_t</a> * M_io_layer_get_handle </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Given a layer object, retrieve the implementation-specific handle </p>

</div>
</div>
<a id="ga4ed8f7126e4355ebc378bc2aefe710a5" name="ga4ed8f7126e4355ebc378bc2aefe710a5"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga4ed8f7126e4355ebc378bc2aefe710a5">&#9670;&nbsp;</a></span>M_io_layer_get_index()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">size_t M_io_layer_get_index </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Given a layer object, retrieve the index of the layer in the parent M_io_t object </p>

</div>
</div>
<a id="ga5458358c5cd46f140520b27d0a17db1c" name="ga5458358c5cd46f140520b27d0a17db1c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga5458358c5cd46f140520b27d0a17db1c">&#9670;&nbsp;</a></span>M_io_layer_read()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> M_io_layer_read </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>layer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>read_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *&#160;</td>
          <td class="paramname"><em>meta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Perform a read operation at the given layer index </p>

</div>
</div>
<a id="ga2bd63bc8d12ca0735492aebcfc9cb759" name="ga2bd63bc8d12ca0735492aebcfc9cb759"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga2bd63bc8d12ca0735492aebcfc9cb759">&#9670;&nbsp;</a></span>M_io_layer_write()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a> M_io_layer_write </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>layer_id</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const unsigned char *&#160;</td>
          <td class="paramname"><em>buf</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t *&#160;</td>
          <td class="paramname"><em>write_len</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga9b9493ef60e89fbb37537ec239ab2724">M_io_meta_t</a> *&#160;</td>
          <td class="paramname"><em>meta</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Perform a write operation at the given layer index </p>

</div>
</div>
<a id="ga15da485fce90d4ec273554a35ec50bfa" name="ga15da485fce90d4ec273554a35ec50bfa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga15da485fce90d4ec273554a35ec50bfa">&#9670;&nbsp;</a></span>M_io_error_is_critical()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">M_bool M_io_error_is_critical </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>&#160;</td>
          <td class="paramname"><em>err</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ga0c6d9cf0f642515db16a6e85d9285bbe" name="ga0c6d9cf0f642515db16a6e85d9285bbe"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga0c6d9cf0f642515db16a6e85d9285bbe">&#9670;&nbsp;</a></span>M_io_layer_softevent_add()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_layer_softevent_add </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool&#160;</td>
          <td class="paramname"><em>sibling_only</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Add a soft-event. If sibling_only is true, will only notify next layer and not self. Must specify an error. </p>

</div>
</div>
<a id="ga91f8925cbfbc6f137b2060db65358748" name="ga91f8925cbfbc6f137b2060db65358748"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga91f8925cbfbc6f137b2060db65358748">&#9670;&nbsp;</a></span>M_io_layer_softevent_clear()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_layer_softevent_clear </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Clear all soft events for the current layer </p>

</div>
</div>
<a id="ga418842462a423550ca48a1c6150cc6fd" name="ga418842462a423550ca48a1c6150cc6fd"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga418842462a423550ca48a1c6150cc6fd">&#9670;&nbsp;</a></span>M_io_layer_softevent_del()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_layer_softevent_del </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io__layer.html#ga2c76e456b8335433f53eadfac91e4533">M_io_layer_t</a> *&#160;</td>
          <td class="paramname"><em>layer</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">M_bool&#160;</td>
          <td class="paramname"><em>sibling_only</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__event.html#ga66b039653a61c8702310d03e6ba69802">M_event_type_t</a>&#160;</td>
          <td class="paramname"><em>type</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Add a soft-event. If sibling_only is true, will only delete the soft event for the next layer up and not self. </p>

</div>
</div>
<a id="ga57d07f7ff756808ff5033b62d2d11c4a" name="ga57d07f7ff756808ff5033b62d2d11c4a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ga57d07f7ff756808ff5033b62d2d11c4a">&#9670;&nbsp;</a></span>M_io_set_error()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void M_io_set_error </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga845c131d8520206a2a7a9219d1bd1932">M_io_t</a> *&#160;</td>
          <td class="paramname"><em>io</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="group__m__io.html#ga2d3bea9aaa4491c3c8dad94cf24498a2">M_io_error_t</a>&#160;</td>
          <td class="paramname"><em>err</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">
<p >Sets the internal error for the IO object. Used within a process events callback if emitting an error </p>

</div>
</div>
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated on Fri Jul 7 2023 16:35:48 for Mstdlib-1.23.0 by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.4 </li>
  </ul>
</div>
</body>
</html>
